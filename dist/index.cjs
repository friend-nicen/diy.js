"use strict";function t(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function e(e,i){let s=function(e,i){let s=t(e)*t(i);if(0===s)return 0;let h=function(t,e){return t.x*e.x+t.y*e.y}(e,i)/s;return h>1&&(h=1),Math.acos(h)}(e,i);return function(t,e){return t.x*e.y-e.x*t.y}(e,i)>0&&(s*=-1),180*s/Math.PI}Object.defineProperty(exports,"__esModule",{value:!0});class i{constructor(t){this._Observer={},this.el=t}register(t,e){"function"==typeof e&&(void 0===this._Observer[t]?this._Observer[t]=[e]:this._Observer[t].push(e))}dispatch(t,e){if(this._Observer[t]){let i=this;e.gesture={event:Object.keys(this._Observer),on:function(t,e){i.register(t,e)},off:function(t){i.remove(t)},destroy:function(){i._Observer={}}};for(let i=0,s=this._Observer[t].length;i<s;i++){let s=this._Observer[t][i];"function"==typeof s&&s.call(this.el,e)}}}remove(t){if(this._Observer[t]instanceof Array)for(let e=this._Observer[t].length-1;e>=0;e--)this._Observer[t].splice(e,1)}}class s{constructor(t,e={}){this.element="string"==typeof t?document.querySelector(t):t,this.userAgent="undefined"==typeof global||"undefined"!=typeof window?/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2?"Mobile":"PC":global.__wcc_version__||0===Object.keys(global).length?"Mini":void 0,this.Observer=new i(this.element),"Mini"===this.userAgent?(this.element.start=this.start.bind(this),this.element.move=this.move.bind(this),this.element.end=this.end.bind(this),this.element.cancel=this.cancel.bind(this)):(this.start=this.start.bind(this),this.move=this.move.bind(this),this.end=this.end.bind(this),this.cancel=this.cancel.bind(this),this.mouseOver=this.mouseOver.bind(this),this.mouseOut=this.mouseOut.bind(this)),"Mobile"===this.userAgent&&(this.element.addEventListener("touchstart",this.start,!1),this.element.addEventListener("touchmove",this.move,!1),this.element.addEventListener("touchend",this.end,!1),this.element.addEventListener("touchcancel",this.cancel,!1)),"PC"===this.userAgent&&(this.mouseLeave=this.mouseLeave.bind(this),this.element.addEventListener("mousedown",this.start,!1),this.element.addEventListener("mousemove",this.move,!1),this.element.addEventListener("mouseup",this.end,!1),this.element.addEventListener("mouseover",this.mouseOver,!1),this.element.addEventListener("mouseout",this.mouseOut,!1),this.element.addEventListener("mouseleave",this.mouseLeave,!1)),this.Observer.register("start",e.start),this.Observer.register("end",e.end),this.Observer.register("pressMove",e.pressMove),this.Observer.register("swipe",e.swipe),this.Observer.register("tap",e.tap),this.Observer.register("doubleTap",e.doubleTap),this.Observer.register("longTap",e.longTap),this.Observer.register("singleTap",e.singleTap),"Mobile"===this.userAgent||"Mini"===this.userAgent?(this.Observer.register("touchStart",e.touchStart),this.Observer.register("touchMove",e.touchMove),this.Observer.register("touchEnd",e.touchEnd),this.Observer.register("touchCancel",e.touchCancel),this.Observer.register("moreFingerStart",e.moreFingerStart),this.Observer.register("multipointEnd",e.multipointEnd),this.Observer.register("pinch",e.pinch),this.Observer.register("twoFingerPressMove",e.twoFingerPressMove),this.Observer.register("rotate",e.rotate)):(this.Observer.register("mouseDown",e.mouseDown),this.Observer.register("mouseMove",e.mouseMove),this.Observer.register("mouseUp",e.mouseUp),this.Observer.register("mouseOver",e.mouseOver),this.Observer.register("mouseOut",e.mouseOut)),this._cancelAllHandler=this.cancelAll.bind(this),"undefined"!=typeof window&&window.addEventListener("scroll",this._cancelAllHandler),this.preV={x:null,y:null},this.pinchStartLen=null,this.zoom=1,this.isDoubleTap=!1,this.delta=null,this.last=null,this.now=null,this.tapTimeout=null,this.singleTapTimeout=null,this.longTapTimeout=null,this.swipeTimeout=null,this.lastTime=null,this.x1=this.x2=this.y1=this.y2=null,this.preTapPosition={x:null,y:null},this.isPress=!1}start(e){this.now=Date.now(),this.isPress=!0,"Mobile"===this.userAgent||"Mini"===this.userAgent?(this.x1=e.touches[0].pageX,this.y1=e.touches[0].pageY):(this.x1=e.pageX,this.y1=e.pageY),this.delta=this.now-(this.last||this.now),this.Observer.dispatch("start",e),this.Observer.dispatch("Mobile"===this.userAgent||"Mini"===this.userAgent?"touchStart":"mouseDown",e),null!==this.preTapPosition.x&&(this.isDoubleTap=this.delta>0&&this.delta<=250&&Math.abs(this.preTapPosition.x-this.x1)<30&&Math.abs(this.preTapPosition.y-this.y1)<30,this.isDoubleTap&&clearTimeout(this.singleTapTimeout)),this.preTapPosition.x=this.x1,this.preTapPosition.y=this.y1,this.last=this.now;let i=this.preV;if(e.touches&&e.touches.length>1){this._cancelLongTap(),this._cancelSingleTap();let s={x:e.touches[1].pageX-this.x1,y:e.touches[1].pageY-this.y1};i.x=s.x,i.y=s.y,this.pinchStartLen=t(i),this.Observer.dispatch("moreFingerStart",e)}this._preventTap=!1,this.longTapTimeout=setTimeout(function(){this.Observer.dispatch("longTap",e),this._preventTap=!0}.bind(this),750)}move(i){let s=this.preV,h=0,o=0;if("Mobile"===this.userAgent||"Mini"===this.userAgent?(h=i.touches[0].pageX,o=i.touches[0].pageY):(h=i.pageX,o=i.pageY),this.isDoubleTap=!1,i.touches&&i.touches.length>1){let n=i.touches[1].pageX,r=i.touches[1].pageY,a={x:i.touches[1].pageX-h,y:i.touches[1].pageY-o};null!==s.x&&(this.pinchStartLen>0&&(i.zoom=t(a)/this.pinchStartLen,this.Observer.dispatch("pinch",i)),i.angle=e(a,s),this.Observer.dispatch("rotate",i)),s.x=a.x,s.y=a.y,null!==this.x2&&null!==this.sx2?(i.deltaX=(h-this.x2+n-this.sx2)/2,i.deltaY=(o-this.y2+r-this.sy2)/2):(i.deltaX=0,i.deltaY=0),this.Observer.dispatch("twoFingerPressMove",i),this.sx2=n,this.sy2=r}else{if(null!==this.x2){i.deltaX=h-this.x2,i.deltaY=o-this.y2;let t=Math.abs(this.x1-this.x2),e=Math.abs(this.y1-this.y2);(t>10||e>10)&&(this._preventTap=!0)}else i.deltaX=0,i.deltaY=0;null!==this.lastTime?i.deltaTime=Date.now()-this.lastTime:i.deltaTime=0,this.isPress&&this.Observer.dispatch("pressMove",i)}this.Observer.dispatch("Mobile"===this.userAgent||"Mini"===this.userAgent?"touchMove":"mouseMove",i),this._cancelLongTap(),this.x2=h,this.y2=o,this.lastTime=Date.now(),i.preventDefault&&i.touches&&i.touches.length>1&&i.preventDefault()}end(t){this._cancelLongTap(),this.isPress=!1;let e=this;t.touches&&t.touches.length<2&&(this.Observer.dispatch("multipointEnd",t),this.sx2=this.sy2=null),this.x2&&Math.abs(this.x1-this.x2)>30||this.y2&&Math.abs(this.y1-this.y2)>30?(t.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout((function(){e.Observer.dispatch("swipe",t)}),0)):(this.tapTimeout=setTimeout((function(){e._preventTap||e.Observer.dispatch("tap",t),e.isDoubleTap&&(e.Observer.dispatch("doubleTap",t),e.isDoubleTap=!1)}),0),e.isDoubleTap||(e.singleTapTimeout=setTimeout((function(){e.Observer.dispatch("singleTap",t)}),250))),this.Observer.dispatch("end",t),this.Observer.dispatch("Mobile"===this.userAgent||"Mini"===this.userAgent?"touchEnd":"mouseUp",t),this.preV.x=0,this.preV.y=0,this.zoom=1,this.pinchStartLen=null,this.x1=this.x2=this.y1=this.y2=this.lastTime=null}mouseLeave(t){this.isPress=!1,this.Observer.dispatch("mouseLeave",t)}mouseOver(t){this.Observer.dispatch("mouseOver",t)}mouseOut(t){this.Observer.dispatch("mouseOut",t)}cancel(t){this.cancelAll(),this.Observer.dispatch("touchCancel",t)}cancelAll(){this._preventTap=!0,clearTimeout(this.singleTapTimeout),clearTimeout(this.tapTimeout),clearTimeout(this.longTapTimeout),clearTimeout(this.swipeTimeout)}_cancelLongTap(){clearTimeout(this.longTapTimeout)}_cancelSingleTap(){clearTimeout(this.singleTapTimeout)}_swipeDirection(t,e,i,s){return Math.abs(t-e)>=Math.abs(i-s)?t-e>0?"Left":"Right":i-s>0?"Up":"Down"}on(t,e){this.Observer.register(t,e)}off(t,e){this.Observer.remove(t,e)}destroy(){return this.singleTapTimeout&&clearTimeout(this.singleTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.swipeTimeout&&clearTimeout(this.swipeTimeout),this.element.removeEventListener("touchstart",this.start),this.element.removeEventListener("touchmove",this.move),this.element.removeEventListener("touchend",this.end),this.element.removeEventListener("touchcancel",this.cancel),this.element.removeEventListener("mousedown",this.start),this.element.removeEventListener("mousemove",this.move),this.element.removeEventListener("mouseup",this.end),this.element.removeEventListener("mouseup",this.end),this.element.removeEventListener("mouseover",this.mouseOver),this.element.removeEventListener("mouseLeave",this.mouseLeave),this.Observer._Observer={},this.preV=this.pinchStartLen=this.zoom=this.isDoubleTap=this.delta=this.last=this.now=this.tapTimeout=this.lastTime=this.singleTapTimeout=this.longTapTimeout=this.swipeTimeout=this.x1=this.x2=this.y1=this.y2=this.preTapPosition=null,"undefined"!=typeof window&&window.removeEventListener("scroll",this._cancelAllHandler),null}}function h(t){if("touches"in t&&t.touches){const e=[];let i=null;for(let s=0,h=t.touches.length;s<h;s++)i=t.touches[s],e.push({x:i.pageX,y:i.pageY});return e}return[{x:t.x,y:t.y}]}function o(t){if("changedTouches"in t&&t.changedTouches){const e=[];let i=null;for(let s=0,h=t.changedTouches.length;s<h;s++)i=t.changedTouches[s],e.push({x:i.pageX,y:i.pageY});return e}return[{x:t.x,y:t.y}]}function n(t,e,i=null,s=!0){if(window.hasImage||(window.hasImage=Object.create(null)),s&&Object.keys(window.hasImage).indexOf(t)>-1)return void e(window.hasImage[t]);const h=new window.Image;h.crossOrigin="anonymous",h.src=t,h.style.display="none",h.onload=()=>{s&&(window.hasImage[t]=h),e&&e(h)},h.onerror=()=>{i&&i()}}function r(t,e,i){let s;return()=>{const h=this,o=arguments,n=function(){s=null,i||t.apply(h,o)},r=i&&!s;clearTimeout(s),r?t.apply(h,o):s=setTimeout(n,e)}}function a(t,e={}){if(null===t||"object"!==typeof t)return t;const i=Array.isArray(t)?[]:{};for(const s in t)"function"!=typeof t[s]&&(t[s]&&t[s].props?i[s]=t[s].props(e):i[s]=a(t[s]));return i}function l(t,e){let i=Math.pow(10,e);return Math.floor(t*i)/i}function c(t,e){if("string"==typeof t&&t.endsWith("%")){return parseFloat(t)/100*e}return t}function u(t,e){return parseFloat(t.toFixed(e))}function d(t,e){return{x:l(t.x-e.x,5),y:l(t.y-e.y,5)}}function p(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}function g(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function f(t,e){let i,s,h=t.x*e.y-e.x*t.y>0?1:-1,o=g(t)*g(e);return 0===o?0:(i=t.x*e.x+t.y*e.y,s=i/o,s>1&&(s=1),s<-1&&(s=-1),Math.acos(s)*h)}function x(t){return 180*t/Math.PI}function y(t,e,i){const s=t.x-i.x,h=t.y-i.y,o=e*Math.PI/180,n=s*Math.cos(o)-h*Math.sin(o),r=s*Math.sin(o)+h*Math.cos(o);return{x:l(n+i.x,3),y:l(r+i.y,3)}}function m(t,e,i){const s=t.x-i.x,h=t.y-i.y,o=-e*Math.PI/180,n=s*Math.cos(o)-h*Math.sin(o),r=s*Math.sin(o)+h*Math.cos(o);return{x:l(n+i.x,3),y:l(r+i.y,3)}}function w(t){let e=Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE,h=Number.MIN_VALUE;return t.forEach((function(t){e=Math.min(e,t.x),i=Math.min(i,t.y),s=Math.max(s,t.x+t.w),h=Math.max(h,t.y+t.h)})),{x:e,y:i,w:s-e,h:h-i}}function v(t,e){return{x:t.x*e,y:t.y*e}}function A(t,e){const i=Object.assign({text:"",x:0,y:0,fontSize:16,fontFamily:"Arial",bold:!1,italic:!1,textDecoration:!1,cornerRadius:5,textColor:"#ffffff",textBaseline:"middle",textAlign:"center",background:!0,backgroundColor:"#ffffff",bound:null,border:1,borderColor:"#000000",direction:"horizontal",spacingLeft:1,spacingTop:1,padding:{top:6,bottom:6,left:6,right:6}},e),s=i.fontFamily?i.fontFamily:"Arial";let h=`${i.fontSize}px ${s}`;i.bold&&(h="bold "+h),i.italic&&(h="italic "+h),t.save(!1),t.font=h,t.textAlign=i.textAlign,t.textBaseline=i.textBaseline,t.fillStyle=i.textColor;const o=i.text.split("\n"),n={x:null,y:null,w:null,h:null};let r=0,a=0;if("vertical"===i.direction)for(let e=0;e<o.length;e++){let s=o[e].split(""),h=0,n=0;for(let e=0;e<s.length;e++){let o=t.measureText(s[e]);o.width>h&&(h=o.width),n+=i.fontSize,e>0&&(n+=i.spacingTop)}r+=h,e>0&&(r+=i.spacingLeft),n>a&&(a=n)}else for(let e=0;e<o.length;e++){let s=o[e].split(""),h=0;for(let e=0;e<s.length;e++){h+=t.measureText(s[e]).width,e>0&&(h+=i.spacingLeft)}a+=i.fontSize,e>0&&(a+=i.spacingTop),h>r&&(r=h)}return n.y=i.y-a/2-i.padding.top,n.h=a+i.padding.top+i.padding.bottom,n.x=i.x-r/2-i.padding.left,n.w=r+i.padding.left+i.padding.right,t.restore(),n}var b={_init(){this._initBound(),this._initStyle(),this._initCanvas(),this._initModel(),this._initGesTure(),this._initEvent(),this.emit("init",{type:"init"}),"auto"===this._mode&&this._global.requestAnimationFrame((()=>this._render(!0)))},_initStyle(){const t=this.bound(),e=document.createElement("style"),i=`.diyjs {position: relative;} .diyjs canvas {position: absolute;transform: translateZ(0);width:${t._w}px;height: ${t._h}px;left: 0;top: 0; }`;e.appendChild(document.createTextNode(i)),document.head.appendChild(e)},_initBound(){this._elem.classList.add("diyjs");const t=this._elem.getBoundingClientRect();this._offset={x:t.x,y:t.y},this.$offset={x:t.x,y:t.y},this._bound={x:0,y:0,w:Math.round(t.width*this._dpr),h:Math.round(t.height*this._dpr),_x:0,_y:0,_w:t.width,_h:t.height}},_initCanvas(){const t=this.bound(),e=this.createCanvas(t.w,t.h,!0,{zIndex:20});if(Object.assign(this._custom,{elem:e.elem,context:e.context}),this._useBuffer){const e=this.createCanvas(t.w,t.h);Object.assign(this._custom,{bufferElem:e.elem,bufferContext:e.context})}},_initModel(){const t=this.bound();this._model=this.createCanvas(t.w,t.h,!0,{zIndex:10,backgroundColor:"#f6f6f6"}),this._model.shapes=[]},_iniCanvasProxy(t,e=null,i=null){const s=this.bound();t.reset=()=>{t.width=e||s.w,t.height=i||s.h},t.size=(e,i)=>{t.width=e,t.height=i},t.reset()},_iniContextProxy(t){const e=this;t._dpr=e._dpr;const i=t.save;t.enableImageSmoothingEnabled=function(){t.imageSmoothingEnabled=!0,t.mozImageSmoothingEnabled=!0,t.webkitImageSmoothingEnabled=!0,t.msImageSmoothingEnabled=!0},t.disableImageSmoothingEnabled=function(){t.imageSmoothingEnabled=!1,t.mozImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.msImageSmoothingEnabled=!1},t.save=function(t=!0){i.apply(this),t&&this.scale(this._dpr,this._dpr)},t.copy=function(t){this.drawImage(t,0,0)},t.clear=function(){this.beginPath(),this.clearRect(0,0,this.canvas.width,this.canvas.height),this.closePath()},t.dpr=function(t){this._dpr=t},t.resetDpr=function(){this._dpr=e._dpr},t.roundCornerRect=function(t,e,i,s,h=5){return function(t,e,i,s,h,o){t.moveTo(e+o,i),t.lineTo(e+s-o,i),t.arcTo(e+s,i,e+s,i+o,o),t.lineTo(e+s,i+h-o),t.arcTo(e+s,i+h,e+s-o,i+h,o),t.lineTo(e+o,i+h),t.arcTo(e,i+h,e,i+h-o,o),t.lineTo(e,i+o),t.arcTo(e,i,e+o,i,o)}(this,t,e,i,s,h)},t.drawText=function(t){return function(t,e){const i=Object.assign({text:"",x:0,y:0,fontSize:16,fontFamily:"Arial",callback:!0,bold:!1,italic:!1,textDecoration:!1,cornerRadius:5,textColor:"#ffffff",textBaseline:"middle",textAlign:"center",background:!0,backgroundColor:"#ffffff",_bound:null,border:1,borderColor:"#000000",direction:"horizontal",spacingLeft:1,spacingTop:1,padding:{top:6,bottom:6,left:6,right:6}},e),s=i._bound?i._bound:A(t,e);if(i.background){let{x:e,y:h,w:o,h:n}=s;t.save(!1),t.fillStyle=i.backgroundColor,t.beginPath(),0!==i.cornerRadius?(t.moveTo(e+i.cornerRadius,h),t.lineTo(e+o-i.cornerRadius,h),t.arcTo(e+o,h,e+o,h+i.cornerRadius,i.cornerRadius),t.lineTo(e+o,h+n-i.cornerRadius),t.arcTo(e+o,h+n,e+o-i.cornerRadius,h+n,i.cornerRadius),t.lineTo(e+i.cornerRadius,h+n),t.arcTo(e,h+n,e,h+n-i.cornerRadius,i.cornerRadius),t.lineTo(e,h+i.cornerRadius),t.arcTo(e,h,e+i.cornerRadius,h,i.cornerRadius),t.closePath()):t.rect(e,h,o,n),t.fill(),i.border>0&&(t.enableImageSmoothingEnabled(),t.strokeStyle=i.borderColor,t.lineWidth=i.border,t.stroke()),t.restore()}const h=i.fontFamily?i.fontFamily:"Arial";let o=`${i.fontSize}px ${h}`;i.bold&&(o="bold "+o),i.italic&&(o="italic "+o),t.save(!1),t.font=o,t.textAlign=i.textAlign,t.textBaseline=i.textBaseline,t.fillStyle=i.textColor;const n=i.text?i.text.split("\n"):[];if("horizontal"===i.direction){i.y=i.y-(s.h-i.padding.top-i.padding.bottom)/2+i.fontSize/2;for(let e of n){let h,o=0,n=e.split("");for(let e=0;e<n.length;e++)o+=t.measureText(n[e]).width,e>0&&(o+=i.spacingLeft);if(t.textAlign="left","center"===i.textAlign)h=i.x-o/2;else if("left"===i.textAlign)h=i.x-(s.w-i.padding.left-i.padding.right)/2;else if("right"===i.textAlign){const t=s.w-i.padding.left-i.padding.right;h=i.x-t/2+(t-o)}for(let e=0;e<n.length;e++)e>0&&(h+=i.spacingLeft),t.fillText(n[e],h,i.y),h+=t.measureText(n[e]).width;i.y=i.y+i.fontSize+i.spacingTop}}else{i.x=i.x-(s.w-i.padding.left-i.padding.right)/2;for(let e of n){let h,o=0,n=e.split("");for(let t=0;t<n.length;t++)o+=i.fontSize,t>0&&(o+=i.spacingTop);if(t.textAlign="left",t.textBaseline="top","center"===i.textAlign)h=i.y-o/2;else if("left"===i.textAlign)h=i.y-(s.h-i.padding.top-i.padding.bottom)/2;else if("right"===i.textAlign){const t=s.h-i.padding.top-i.padding.bottom;h=i.y-t/2+(t-o)}let r=0;for(let e=0;e<n.length;e++){e>0&&(h+=i.spacingTop),t.fillText(n[e],i.x,h);let s=t.measureText(n[e]);s.width>r&&(r=s.width),h+=i.fontSize}i.x+=r+i.spacingLeft}}return t.restore(),s}(this,t)},t.textBound=function(t){return A(this,t)}},_initGesTure(){const t=this;this._gesture=new s(this._custom.elem,{start(e){t.emit("start",{type:"start",coords:e});const i=t.filterCoords(h(e));t._startPoint=i[0],t._eventTouch(i)},end(e){const i=t.filterCoords(o(e));t._startPoint&&1===i.length&&Math.abs(i[0].x-t._startPoint.x)<5&&Math.abs(i[0].y-t._startPoint.y)<5&&t._eventTouch(i,!0),t._eventUp(i)},pressMove(e){t._eventMove(t.filterCoords(h(e)))},rotate(e){t._eventRotate(e.angle,t.filterCoords(h(e)))},pinch(e){t._eventPinch(e.zoom,t.filterCoords(h(e)))},doubleTap(e){t.emit("doubleTap",{type:"doubleTap",coords:t.filterCoords(h(e))})}})},_initEvent(){const t=this;this._custom.elem.addEventListener("mouseleave",(e=>{const i=t.filterCoords(o(e));t._eventUp(i)})),this._global.addEventListener("resize",r((()=>{t._initBound(),this._gesture.destroy(),t._initGesTure()}),200))},_eventTouch(t,e=!1){let i=0;this._clicked=null;const s=this.shapes();for(const h of t){let{x:o,y:n}=v(h,this._dpr);for(let h=s.length-1;h>=0;h--){let r=s[h],a=r.clicked;this._clicked?(r.click(o,n,!1),e&&!this._multiActive&&r.deactivate(!1)):r.click(o,n,!1,t)?(i++,this._clicked=r,e&&(r.tap({x:o,y:n})?this._actived!==r&&(this._actived=r):this._actived=null)):e&&!this._multiActive&&(this._actived=null,r.deactivate(!1)),r.clicked!==a&&i++}if(this._clicked)break}this._clicked||this._actived||this._multiActive||(this.emit("click-blank",{type:"click-blank"}),this.emit("deactivate",{type:"deactivate",shape:this.shapes()})),"event"===this._mode&&i>0&&(this._loop=!0,this._render())},_eventMove(t){if(t.length>2)return;const e=this.getHandler();if(e){if(!e.canMove)return;let{x:i,y:s}=t[0];this._isMoving||(this._startOffset={x:i-e.x,y:s-e.y},this._isMoving=!0),e.move([{x:i,y:s}],this._startOffset)}},_eventPinch(t,e){if(e.length>2)return;const i=this.getHandler();if(i){if(!i.canScale)return;i.scale(t,e)}},_eventRotate(t,e){if(e.length>2)return;const i=this.getHandler();if(i){if(!i.canRotate)return;i.rotate(t,e)}},_eventUp(t){this._isMoving=!1,this.emit("end",{coords:t});const e=this.getHandler();if(e){if(!e.canUp)return;e.up(t)}"event"===this._mode&&(this._loop=!1)},_render(t=!0){if(!this._stop){if(this._new||!t){if(this._new=!1,this.getContext().clear(),this.getContext().closePath(),this._view.shape&&this._view.shape.clip){this._view.shape.stokeOutline();for(const t of this.shapes())t.draw()}else for(const t of this.shapes().concat(this._view.shape?[this._view.shape]:[]))t.draw();if(this.getQueue().length>0){for(const t of this.getQueue())t();this.clearQueue()}this._useBuffer&&(this._custom.context.clear(),this._custom.context.copy(this._custom.bufferElem))}this._loop&&t&&this._global.requestAnimationFrame((()=>this._render(t)))}},getHandler(){return this._limit?this._clicked:this._actived},getLimit(){return this._limit}},C={render(){this._new=!0},bound(){return this._bound},dpr(){return this._dpr},shapes(t=!1,e=-1){if(-1===e)return t?this._shapes.map((t=>t)):this._shapes;if("number"==typeof e)return this._shapes[e]?this._shapes[e]:null;if("string"==typeof e)for(let t of this._shapes)if(t.name===e)return t},getActive(){return this._actived},getViewBound(){return this._view.bound},getView(){return this._view.shape},getIndex(t){return this._shapes.indexOf(t)},canMultiActive(){return this._multiActive},getColorBound(t,e=!1){const i=t.context._dpr,s=Math.round(t.elem.width/i),h=Math.round(t.elem.height/i),o=this.createCanvas(s,h).context;o.enableImageSmoothingEnabled(),o.clearRect(0,0,s,h),o.drawImage(t.elem,0,0,s,h);const n=o.getImageData(0,0,s,h);let r=s,a=h,l=0,c=0;for(let t=0;t<h;t++)for(let e=0;e<s;e++){const i=Math.floor(4*(t*s+e));n.data[i+3]>0&&(r=Math.min(r,e),l=Math.max(l,e),a=Math.min(a,t),c=Math.max(c,t))}return e?{x:r,y:a,w:l-r,h:c-a,_x:Math.floor(r*i),_y:Math.floor(a*i),_w:Math.round((l-r)*i),_h:Math.round((c-a)*i)}:{_x:r,_y:a,_w:l-r,_h:c-a,x:Math.floor(r*i),y:Math.floor(a*i),w:Math.round((l-r)*i),h:Math.round((c-a)*i)}},createCanvas(t,e,i=!1,s={}){const h={};h.elem=document.createElement("canvas");for(let t in s)h.elem.style[t]=s[t];return h.context=h.elem.getContext("2d",{willReadFrequently:!0}),this._iniCanvasProxy(h.elem,t,e),this._iniContextProxy(h.context),i&&this._elem.appendChild(h.elem),h},async export(t={},e=null){const i=Object.assign({elem:["model","custom","view"],view:!0,clip:!0,type:"base64",filter:!1,ratio:3.5,size:null,frame:null},t);e=e||{model:this._model.shapes,custom:this.shapes(),view:this._view.shape};const s=this.bound(),h={_x:0,_y:0,_w:Math.round(s._w*i.ratio),_h:Math.round(s._h*i.ratio)},o=this.createCanvas(h._w,h._h),n=o.context;n.enableImageSmoothingEnabled(),n.dpr(i.ratio);const r=this.createCanvas(h._w,h._h);r.context.enableImageSmoothingEnabled(),r.context.dpr(i.ratio);let a=null;if(i.view){const t=e.view.getColorBound();t&&(a={_x:t._x*i.ratio,_y:t._y*i.ratio,_w:t._w*i.ratio,_h:t._h*i.ratio})}if(n.beginPath(),n.clearRect(0,0,h._w,h._h),i.elem.indexOf("custom")>-1)for(const t of e.custom.concat(e.view&&i.elem.indexOf("view")>-1?[e.view]:[]))!t.canExport&&i.filter||(t.bindContext(n),t.draw(!1),t.bindContext(this.getContext()));if(i.elem.indexOf("model")>-1&&e.model.length>0){const t=r.context,i=e.model;t.beginPath(),t.clearRect(0,0,h._w,h._h);for(const e of i)e.bindContext(t),e.draw(!1),e.bindContext(this._model.context);n.save(!1),n.globalCompositeOperation="destination-over",n.drawImage(r.elem,0,0,h._w,h._h),n.restore()}const{_x:l,_y:c,_w:u,_h:d}=a||(i.clip?this.getColorBound(o,!0):h);if(r.elem.size(u,d),r.context.beginPath(),r.context.clearRect(0,0,u,d),r.context.save(!1),r.context.putImageData(n.getImageData(Math.floor(l),Math.floor(c),Math.round(u),Math.round(d)),0,0),r.context.restore(),i.size&&Array.isArray(i.size)){1===i.size.length&&(i.size[1]=i.size[0]/(u/d));const t=new Image(i.size[0],i.size[1]);t.src=await new Promise((t=>{r.elem.toBlob((function(e){t(URL.createObjectURL(e))}))})),await new Promise((e=>{t.onload=()=>{e()}}));let e=i.size[0],s=i.size[1];r.elem.size(e,s),r.context.beginPath(),r.context.clearRect(0,0,e,s),r.context.save(!1),r.context.drawImage(t,0,0,e,s),r.context.restore()}else if(i.frame){const t=Object.assign({height:750,width:750,fillColor:"#ffffff"},i.frame);let e=u,s=d;const h=new Image(e,s);h.src=await new Promise((t=>{r.elem.toBlob((function(e){t(URL.createObjectURL(e))}))})),await new Promise((t=>{h.onload=()=>{t()}}));const o=e/s;t.width<e&&(e=t.width-60,s=e/o),t.height<s&&(s=t.height-60,e=s*o),r.elem.size(t.width,t.height),r.context.beginPath(),r.context.clearRect(0,0,t.width,t.height),r.context.save(!1),r.context.fillStyle=t.fillColor,r.context.fillRect(0,0,t.width,t.height),r.context.drawImage(h,(t.width-e)/2,(t.height-s)/2,e,s),r.context.restore()}return new Promise((t=>{"blob"===i.type?r.elem.toBlob((function(e){t(e)}),"image/png"):t(r.elem.toDataURL("image/png"))}))}},_={_listener:new Map,_pauseEvent:[],pauseEvent(t){-1===this._pauseEvent.indexOf(t)&&this._pauseEvent.push(t)},withEventPause(t,e){this.pauseEvent(t),e(),this.resumeEvent(t)},resumeEvent(t){const e=this._pauseEvent.indexOf(t);e>-1&&this._pauseEvent.splice(e,1)},on(t,e,i=!1){if("function"!=typeof e)throw new TypeError("listener must be a function");const s=Array.isArray(t)?t:[t];for(let t of s)this._listener.has(t)||this._listener.set(t,[]),0!==this._listener.get(t).length&&i||this._listener.get(t).push(e)},async emit(t,...e){if(!(this._pauseEvent.indexOf(t)>-1)&&this._listener.has(t)){const i=this._listener.get(t);for(const t of i)try{await t.apply(null,e)}catch(t){}}},off(t,e){const i=Array.isArray(t)?t:[t];for(let t of i)if(this._listener.has(t)){const i=this._listener.get(t),s=i.indexOf(e);-1!==s&&i.splice(s,1)}},removeAlllistener(t){this._listener.delete(t)}},E={move(t,e){if(t.length>1)return!1;const{x:i,y:s}=t[0];return(i!==this._previous.x||s!==this._previous.y)&&(this._previous.x=i,this._previous.y=s,this.actived&&this._action&&this._acting?(this._action.move(t,e),this.render(),!0):(this.emit("move",{type:"move",coords:t,offset:e,shape:this}),this.stage().emit("move",{type:"move",coords:t,offset:e,shape:this}),this.x=i-e.x,this.y=s-e.y,this.render(),!0))},scale(t,e){if(!this._startBound){const t=this.stage().getLimit()&&e.length>1?p(e[0],e[1]):this._group?this._group.getCenterPoint():{x:this.x+this.w/2,y:this.y+this.h/2};this._startBound={w:this.w,h:this.h,x:this.x,y:this.y,centerX:t.x,centerY:t.y}}t=l(t,2);const{x:i,y:s,w:h,h:o,centerX:n,centerY:r}=this._startBound;return this.x=n-(n-i)*t,this.y=r-(r-s)*t,this.w=h*t,this.h=o*t,this.emit("scale",{type:"scale",coords:e,zoom:t,shape:this}),this.stage().emit("scale",{type:"scale",coords:e,zoom:t,shape:this}),this.render(),!0},rotate(t,e){if(1===e.length)this._startAgree||(this._startAgree=this.rotateRadius),this.rotateRadius=this._startAgree+t;else{const e=this.stage().getConfig();Math.abs(t-this.rotateRadius)>e.minRotatable&&(this.rotateRadius+=t/(100-e.sensitivity))}return this.emit("rotate",{type:"rotate",coords:e,rad:t,shape:this}),this.stage().emit("rotate",{type:"rotate",coords:e,rad:t,shape:this}),this.render(),!0},tap(t){return this.emit("tap",{type:"tap",coords:t,shape:this}),this.stage().emit("tap",{type:"tap",coords:t,shape:this}),this.actived&&this._action&&this._acting?(this._action.tap(t),this.render(),this.actived):(this.toggle(),this.render(),this.actived)},up(t){this._startAgree=null,this._startBound=null,this.actived&&this._action&&this._acting&&(this._action.up(t),this.render()),this._group||(this.emit("up",{type:"up",coords:t,shape:this}),this.stage().emit("up",{type:"up",coords:t,shape:this}))},export(t={}){return this.stage().export(Object.assign({elem:["custom"],view:!1},t),{custom:[this]})}},I={_listener:null,on(t,e){if("function"!=typeof e)throw new TypeError("listener must be a function");const i=Array.isArray(t)?t:[t];for(let t of i)this._listener.has(t)||this._listener.set(t,[]),this._listener.get(t).push(e)},async emit(t,...e){if(this._listener.has(t)){const i=this._listener.get(t);for(const t of i)try{await t.apply(null,e)}catch(t){}}},off(t,e){const i=Array.isArray(t)?t:[t];for(let t of i)if(this._listener.has(t)){const i=this._listener.get(t),s=i.indexOf(e);-1!==s&&i.splice(s,1)}},removeAlllistener(t){this._listener.delete(t)}};let S=class{constructor(t){Object.assign(this,{image:null,corner:null,blendMode:"source-over",gap:3,w:24,h:24,shape:null,strokeStyle:"#e3e3e3",canActive:!1,canRemove:!1,canRotate:!1,canScale:!1,canExport:!1,canMove:!1},t)}_coords(t){return 0===this.corner?{x:t.x-this.gap,y:t.y-this.gap}:1===this.corner?{x:t.x+this.gap,y:t.y-this.gap}:2===this.corner?{x:t.x-this.gap,y:t.y+this.gap}:3===this.corner?{x:t.x+this.gap,y:t.y+this.gap}:4===this.corner?{x:t.x,y:t.y-this.h-this.gap}:5===this.corner?{x:t.x+this.gap+this.w,y:t.y}:6===this.corner?{x:t.x-this.w-this.gap,y:t.y}:7===this.corner?{x:t.x+this.gap,y:t.y+this.gap+this.h}:void 0}_draw(){if(!this.image)return;const t=this.shape.getContext();let e=this.shape.coords(this.corner),{x:i,y:s}=this._coords(e);t.beginPath(),this.shape._rotate(),t.rect(i-(this.w+10)/2,s-(this.h+10)/2,this.w+10,this.h+10),t.closePath()}draw(){const t=this.shape.getContext();let e=this.shape.coords(this.corner),{x:i,y:s}=this._coords(e);t.beginPath(),t.save(!0),this.shape._rotate(),t.globalCompositeOperation=this.blendMode;const h=this.w/2;t.drawImage(this.image,i-h,s-h,this.w,this.h),t.arc(i,s,h-1,0,2*Math.PI),t.strokeStyle=this.strokeStyle,t.lineWidth=1,t.stroke(),t.closePath(),t.restore()}click(t,e){const i=this.shape.getContext();return i.save(),i.setViewClip&&i.setViewClip(),this._draw(),this.clicked=i.isPointInPath(t,e),i.restore(),this.clicked}move(t,e){}tap(t){}up(t){}};class R extends S{tap(){this.shape.destroy(!0)}}class O extends S{constructor(t){super(Object.assign(t,{startPoint:null}))}move(t){this.startPoint||(this.startPoint=t[0]);let{x:e,y:i,w:s,h:h}=this.shape.bound();const o={x:e+s/2,y:i+h/2};let n=f(d(o,this.startPoint),d(o,t[0]));this.shape.rotate(n,t)}up(){this.startPoint=null}}class B extends S{constructor(t){super(Object.assign(t,{startScale:null,rectCenterPoint:null}))}move(t){if(!this.startScale){let{x:e,y:i,w:s,h:h}=this.shape.bound();this.rectCenterPoint={x:e+s/2,y:i+h/2},this.startScale=g(d(this.rectCenterPoint,t[0]))}let e=g(d(this.rectCenterPoint,t[0]));this.shape.scale(e/this.startScale,t)}up(){this.startScale=null,this.rectCenterPoint=null}}let T=class extends S{_draw(){const t=this.shape.getContext();t.beginPath(),this.shape._rotate(),t.rect(this.x,this.y,this.w,this.h),t.closePath()}draw(){const t=this.shape.getContext();let e=this.shape.coords(this.corner),{x:i,y:s}=this._coords(e);t.save(!0),t.beginPath(),this.shape._rotate(),t.globalCompositeOperation=this.blendMode,Object.assign(this,t.drawText({x:i,y:s,border:1,borderColor:"#e3e3e3",textColor:"#000000",fontSize:10,cornerRadius:8,padding:{top:5,bottom:5,left:8,right:8},callback:!1,text:this.shape.button_2_Text})),t.closePath(),t.restore()}tap(){this.shape.stage().emit("to-do",{type:"to-do",shape:this.shape})}};class M{constructor(t={}){Object.assign(this,{active:null,shape:null,action:[],gap:3},t),this.shape.canRemove&&n("data:image/png;base64,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",(t=>{this.action.push(new R({image:t,corner:0,shape:this.shape})),this.shape.render()})),this.shape.canRotate&&n("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAGk1JREFUeF7tXQm0FcW13VtcTvhRTDQGExVF/Q4YFQe+s341iQNiACGAJk4oOAVdiiOKgQgOcSko+BXHGEVFnMigOEH86pcYRKMxAmIclhMaNIqamPpr39Xv+Xi8e2933eq+3dV11roLE6pOnbOrN1VdfeocIkhAICBQFQEGbAICAYHqCASChKcjIFADgUCQDB4PY8wqALoBWB/AegDWBfANAF0BrAWgS/RbPTJnGYCPo99SAB8BWALgfQDvAXgHwNskv8zA/FIPEQjiaPqNMd8BsAWAHgA2BdAdwEYAdnI0RDU1zwJ4HcBrABYCWADgFZJvpjxuKdQHglhMszGmM4C9AOwJYA8A20QrgIW21LpoBXoRwBwAswE8TvKz1EbzVHEgSMyJNcbsAmB/AP0AbBezW96azQMwHcDDJJ/Jm3F5tCcQpMqsRO8NBwM4EMAxeZw8BzZNBfAbAA+G95mO0QwEaYOLMWYNAIcB6Augv4MHsEgq7gZwL4AZYSv29bQFggAwxmjbNADAwCI90SnaOg3AXSS1HSu1lJYgxpjeAIZGPx21BlkRAR0x/0o/kk+XEaDSEcQYMwjA8OgEqoxzbuuzTsOmkPy1rYIi9isNQYwxIsXJALYs4kTlyOZXAEwiOSlHNqVmivcEMcaIFKcB2Dg1FMupWB8if0nyCp/d95YgxpjjAIyKvmr7PIfN9k1f8S8heU2zDUljfO8IYow5FMB5AHZMA7CgsyoC8wGMJXmXTxh5QxBjTE8AY6LvGD7NUdF8mQlgNMnnimZ4R/Z6QRBjzFgA5/owIR75cAmAc0h+VWSfCk0QY8whACaEk6ncPoKKLB5F8p7cWljHsEISxBizGgCdnpxQVOBLZvf1Okkk+UnR/C4cQYwxCh68Mrp3UTS8y2zvYgCnkry/SCAUiiDGmIsBnFUkgIOtKyBwKckzi4JLIQhijNkMwLUA9ikKsMHOmgjoAtfxJP+Sd5xyTxBjjMLOtYcNAYV5f5qS2fcP3bMheWeybtm2zjVBjDGjo28b2aISRssSgTEkL8xywCRj5ZYgxphbAByRxJnQtrAI3Ka5Jmny5kHuCBJlB1FItZIhBCkPAn8AMJjkG3lyOVcEMcb0AqDbbEqbE6R8CCzSrU6Sc/Piem4IYoxRxhDdi1YStSDlRUDpigaQfCgPEOSCIMaYH0XpaPKASbAhHwj0y0OIStMJYowZDEAvaUECAu0RGNLsK75NJYgxRkkTbg3PRUCgBgI63VLiiKZI0wgSVo6mzHdRB23aStIUgoR3jqI+p021uynvJJkTJDqtysUJRVOnOwxug8ABJB+26WjbJ1OCRN85Hg1HubbTVfp+OgLel+Qfs0IiM4JEX8gfDx8Bs5pab8dRDZS9s6p/kiVBFOIcwke8fW4zdWwOSdVmSV0yIUgIPEx9Hss4wK0kj0zb8dQJEkLW057CUuu/gORFaSKQKkGiy05eJRJLczKCbisEFLelGL5UJDWCRNdkVWAy3ARMZeqC0ggBlWjYieSraSCSJkF0nBvukKcxa0FnewQeI7lvGrCkQpCQfSSNqQo66yAwnuTZrlFyTpAob5XyswYJCGSNwEEkVZTUmTglSJTx8IWQ1M3Z/ARFyRBQqtOeJD9P1q16a9cEmRzSgbqamqDHEgGViVM1MSfijCBRIulCpZV0gmBQkkcE+pB8wIVhLgnyUsiy7mJKgg4HCLxMcisHeuCEIKE+h4upCDocIzCOpCqNNSQNEySq7KTyW0ECAnlDYFuSOjSyFhcEUXGUw6wtCB0DAukhMIOkMuZYS0MEiQpm3ms9eugYEEgfgb4k77MdplGCKNYqVJO1RT/0ywKBuSR3sh3ImiBRHfL/sR049AsIZIjAMJLX2YzXCEEUPdnDZtCy95k/fz7mzZuHDz/8EF988QU+//zzyk//vWzZssqf66+/Pr797W9X/mz732uuuWbZ4bPxfyFJq2fViiDGmJMBXGVjadn6LF26tEIG/UQM/UQGW9l4442x9957Y/fdd8eOO+6ITp062aoqW79TSE5M6rQtQV4DsHHSwcrSfu7cuXjsscfwwgsv4Pnnn8e///3vVFzv0qVLK1F22203dOvWLZVxPFG6mGT3pL4kJogxRnEu1yQdyPf2H3/8MX7/+99Xfs8880zm7nbu3Bk//OEP8YMf/AC77LJL5uMXZMARJBUvGFtsCBJCStrAqy2TSPHb3/4W77//fmzg02wogogoIoyIE6QVgcQhKIkIYowZBOD2ADhw33334Xe/+x3+8AcVRsqnaMs1ZMgQHHlk6sk/8glAx1b9mOQdcQ1OSpAnAGSSjyiuA1m3W7RoESZNmoSHH840A2ZDbu66664YNmwYevVSAa/Sy2ySe8VFITZBjDG9ATwVV7GP7aZPn46rr746N1uppBiLJPqtuuqqSbv61v6/SD4dx6kkBJkE4MQ4Sn1r8+6772LixImVbVXRZZtttqmQZJ99Sp1P42qSJ8WZyyQE+XsZU/joPUOrxuLFi+PgWZg2P/vZz3DMMccUxl7Hhi4luXYcnbEIYozpFxXYjKPTmzbjx4/Hbbf5Wx3u0EMPxdixY72Zr4SO9Cc5vV6fuATRW//Aesp8+vtzzjkHDzzg5NZmrmHZbrvtcOutpayCN42kTmVrSl2CGGPWAPBpPUU+/f24ceNwxx2xTwIL7/raa6+NOXPmFN4PCwc6k/ysVr84BBkCoGlFFC2cbqjLFVdcgRtuuKEhHUXs3LVrV8yerQoVpZKhJGvuoeMQRMmn+5cBtmuuuQaTJyeKRLCGZaONNsJWW20FBR9Wk9dffx1//vOfoT+zEH0nuemmm7IYKi9j3E1ygPUKYoxZBcAXefEmTTvSJIe+aO+www7o0aMHtthiC+ioVduauKKw+JdffhkvvfRS5U8FQv7rX/+K2z1RuwEDBmD06NGJ+hS88aokv6zmQ80VpCzVaNMih75gf//736/ERa2xhl7l3MjChQtx//33V34ffPCBG6VttBx11FE47bTT6updsmQJ9Pvqq6+w2WabYeWVV67bJ4cNalbPrUeQ6wF4fVg+ZswY3H23u/IS66yzTisptGqkKSKHSKLTtgULlHXTnRx//PE46aSOv6Up/uz666/HH//4dS3NVVZZpbJl1ArUp08fd4akr2kqyWNtVxCTvn3NG0EnNyNGjHBmwEEHHYSTTz4ZG2ywgTOdcRRpu3XnnXdi6tSpeO+99+J0idXmqquuWuGL+3XXXQf9/7VEUcSXXHJJrDHy0Ihk1YWi6l8YY3SpIFa8Sh6cTGqDLjH95Cc/qdz0a1R0DVbEGDx4cKOqGur/xhtvVEiimDEXsvXWWy933K2VVituHLnwwgvRr5++LxdCepPs8BJPLYIoK93PC+GehZFTpkyphJA0KrrJJ3LoYcqLPPLII5Ut0IsvvtiwSUcffTRGjhxZ0dOzZ89E+hSFsO222ybq06TG55PsMKSgFkH+BGC7Jhmc6rC65PTTn/4U//znPxsaZ/jw4U63aA0Z067zl19+WSGJi2Pru+66CwrYrPZOUs3uww8/HOeff75Lt9LSNY/k9h0p75Agvn8917/4jz/+eENg55kcbR1zcUK3/fbbQyEpN954YyLMChbGsibJFSJGqhHkQABeVom6/fbb8Ytf/CLRRLdvXBRytNjtgiR62JO+r+louxn38y0nt8PqVNUIMh7AKMuBctvtb3/7G3TG38hJT9HI4ZIkSSdW7x8FioaeQPKs9j5WI8iTAHZNCkje22vl0ApiK0UlR7NIUjC8/pfkbnEJotrTXWwfpDz2++STT6D7D7aZR5T84KyzVvgHJo+u1rTJxftXXKf1j5HCagoiH5Ncqy5BjDHfAfBGQZyKbeaMGTOsY4y6d+9eCeLTV/I8i3Jz6fuDvqprG6mUP/q6vckmm1TCXbbccstK4KOObhvZZsbBQFd6631QjKMn4zbfJflm2zFX2GIZY/4bwKyMDUt9OB1RPvGEkrIkl4svvhgHH3xw8o4Z9lAQo9L7VEtrutJKK2HgwIE44ogjKhkfR41K9xVzwoQJOPBAnfUUSvYj+Ug9ghwPYEqh3Kpj7CuvvIL+/e0i9kUMESTP8uabb1aSxMWR1VZbrUIUyc033xynS+I2m266Ke655x6IlAWTE0heW48gCqI5o2CO1TRXX8z15TypaEulrZW2WHkWffRsGzgYx1bl9VXo/bPPqsSLWznxxBNxwgknuFWajbZLSZ5ZjyDeXZA67LDDrKJd9VKul/M8y3PPPVeJKbMVvad8+qm7G9UKedf7Xq2LYLa2ZtBvhQtUHb2D/B8A64o8GTiRaAhdLjrllFMS9VFj1ea49957nd7jSGxEjA4uPgLGGCZ2kyJsSWs48yzJneutIF6FuJ977rmVOxNJRS+8Z5yR/51mlse2cTDUdnbPPYubnbZ96PtyK4iPV2wPOeQQq6RvSoWj8Iq8i4IRtYrkQQr25bwaZMtdwW1PEGUQUHEcL0R3uffaK3ae4lafVT5AkbBFEJVdOPPM5d4rm2a27NAxcsGlO8nWNJrtCeJVgmqd7OiEJ6koRFuh2kUQRQjomutbb73VVHOVhEJHu+uuu25T7XAw+HKJrdsTRJeJi5+hOUIpyQ24FmD1neChhx6C8kQVRR599FGceuqpTTV30KBB0PueB3IoydaX1vYEUYKGYuwtYsyETW5dhWZMmzYthvZ8NZk5c2ZTY8X00THtJBUZIX4syaktY7UniDazEzIyJPVhFHOU9ENYkY8p3377bVx66aWYNSvbSCGlN7r22uU+QKc+tykOMIpka8aJ9gRRTEXxQ1Yj9HRfXAF8SUTfTI477rgkXXLXVpeUlApIx9vGpH9qf9FFF0EfYz2R8STPrraC6LxQVWwLL++88w7233//xH4oN+9+++2XuF8eO/z1r39tTTD30UcfpWKiUhzpy/nqq6+eiv4mKJ1MsjUXVPsVREmq8x1bERMxba20xUoqqiKl8HCfRKHtLSuKaiy6FBXhUTEej+Q2kkOrrSB6ez/EB2dtCaJQcF9FWVxaUpYqhsuF6KRQQY8eyQMkW1NDtl9BVLrVi/1FIEjtR1ZHwyKLcmjZygEHHIDLL7/ctnte+80i2bo3DwRpN00+ryAdPZFaSVq2X8qlFVf0zqErtbr74ZnUJEjYYnm8xar1IL/22mut268413EV6ewhOQRRzS1W6V/Sy7aCtCeNTrtaVhTdxGwv3/ve9yqFPwt63yPOYlfzJd2bY97wDhLnWajdRlHCygKjFUUVsRTG3ru3wvW8lprHvN58KAwE8fohTtO5mh8KvQk1sSWITnbyfgc9zacj6EbNUBNvghWV/8kmVY+yL+qSVZDSIlAzWNGrcHebWCwVwTn77NZQnNI+JSV2vGa4u1cXppR65sknlWY4vnhybTS+w6FlewRqXpjy6sqtTT6sTp06VTIwrrXWCmlaw6NUDgRqXrn1qi66wihsAul0vLnHHnuU43EIXrZHoHrSBrU0WVwgyGhSVNTSJj9s37598fOfe1ueMSP0izlMzbQ/EUG8ShynrOZJExqoaq1CKb71rW8Vc5aD1bYIxEoc51XqUW2xbCJWlf186NDWawG2gId+xUIgVupRr5JX26bmVAKCtLKfF+uZKZW1sZJXe1X+QHUJVdC+Wt2MWtM/depU7LzzcqlaS/W0lNDZWOUPvCugM2bMGOjmW1JRyTZFrgYpDQKxCuh4V4LNNsOiHgudZulUK0gpEKhfgi06yfKuiKeKusyePTvxLHfr1g033HADlL0jiNcIxCviGRHEuzLQjSR5Dlstr4nR4lyiMtDjAaRb5bEJmCshtYpd2kjYatmgVqg+E0iukDRxhQpT0Qqi8qQzC+VeDGNvueWWSmpOG9FWS0fGnt7DtoHEtz4HkfxNe6eqEaQzgH/4hsCSJUugcHblsLWRHj164LLLLgsksQEv/306k/wsFkGiVeRPAPJfYikh8DYlEdoOEUiSEPBiNJ9HcvuOTO1wBYkIcp5OOYvhXzIrR44c2VAG9ECSZHgXoPX5JDv84FWLILsAeLoAziU2US/qKp28bNmyxH1bOgSSWEOXx469ST6TaAWJVpH0c+c3CS7VILzyyisbGl0v7sOHDw8fEhtCsfmd24e4t7Wo6goSEUTVppTIwUs56qijMHfu3IZ903cSESV8TGwYymYomEry2GoD1yPIjwBMb4bVWYz51FNPYdiwYU6GCquJExiboaQfyXtsCeLVFdyOQNCxrcuwdq0mffr0CVHAzXjU7cZc7optexU1V5Bom+XVBaqOMDz99NMrlW1diu6TqMKVfuFmoktknepa4YKUDUFUcUpJrb2WNEgiwHR9VyXdVEtj6623xjrrrOM1jgVzbijJ22rZHGcFWQPApwVz3MrctEjS1pjNN9+8UpFJ5aaVKb1nz55WtoZOThDo8Ot5W811CRJts+4AMNCJSTlXkgVJ4kKw3nrr4Zvf/GaFRLof73HJgbiQuGw3jeSgegrjEqQfgORX8uqNntO/zxNJWiDq0qULhgwZghEjWguw5hS9wpjVn2TdE9pYBIlWkb8DKE26wTySRPMwevRoDBgwoDBPYU4NXUpy7Ti2JSHIJAAnxlHqS5vzzjsPKgudN5k8eTJ23333vJlVJHuuJnlSHIOTEMSrxNZxwFEbRf9OmjQJCpXPi4QM9A3PxHIJqmtpi02QaJulS92lS1q7cOHCCklmzZrV8My4ULDhhhti5kzv7rO5gCaOjtkk94rTUG2SEmQwgJrnxnEHLmI73UicOHGiVY4t1/6WvdhoA3j+mKROZWNJIoJEq8hfAGwRS7uHjebPn19ZTRTH1SzRN5Rp06Y1a/gij/syya2SOGBDEL3cTEwyiI9tdT9d2xxlbsxa+vfvjwsuuCDrYX0YbwTJyUkcSUyQaBV5A4ASzJValM70wQcfrPyUnC4rCadYVkgvJtk9aU9bgowE8Mukg/ncXknpRBTl30pTFCk8bty4NIfwVfcpJBPvfKwIEq0iiwFs5Cuatn7pOq+Iou2X66NhRQgrz3AIOUk8OwtIbpa4V9JTrLYDGGMU83C1zaBl6KP77joeXrBgARYtWlT5U//bJuVQ165dK6WpzzjjjDJAl4aPw0heZ6PYegWJVpHnAWxrM3BZ+yxdurRClldffRUffvhhXRh69eoF/VZeeeW6bUODDhGYS3InW2waJYiCgu60HTz0CwhkgEBfktbxQg0RJFpFHgRwUAaOhiECAkkRmEFSeRWsxQVBdgCQ3RmntauhYwkR2JbkC4343TBBolVkAoAzGzEk9A0IOEZgHEllB21IXBGkEwCFoPRoyJrQOSDgBoHEISXVhnVCkGgV8TqHlpt5C1oyQqAPyQdcjOWMIBFJdNZcNUudC4ODjoBAHQSmkBzuCiXXBPkPAPMBbOzKwKAnIJAAgQUAepL8PEGfmk2dEiRaRfoAsD53duVY0FNKBDqsEtUIEs4JEpHkEgAhLqKRmQl9kyIwnuTZSTvVa58KQSKSPAFgz3oGhL8PCDhA4DGS+zrQs4KKNAnynwCeVfbNNAwPOgMCEQJLAexE8tU0EEmNINEqcjiAcDc0jZkLOlsQGEAytaSGqRIkIsmFAML90PBAp4HABSQvSkNxi87UCRKRRNnhlSU+SEDAFQK3kjzSlbJqerIiiMZRTq2QDjDtGS2H/jkkMzkAyoQg0SryXQCPA9ikHHMYvEwJgYUA9ib5Zkr6l1ObGUEikuwI4BEAXbJwLozhHQIfA9iXZGbXKzIlSESS/QG4rXfm3XMQHKqCwAEkH84SncwJEpEkRP5mOct+jFWzGm1aLjaFIBFJSp3nN60J9VTvEJK/boZvTSNIRJKhAG5thuNhzMIgcATJphWRbSpBwkpSmIe0WYY2beVocbjpBAnvJM169nI/blPeOdqjkguCtDndUkxNOALO/bObqoE6ylWBzUxPq6p5lBuCRCTpFQU3bprqFATleUVAHwEHZvmdox4QuSJIRBKVVdCJRelKvdWbLM//fg6AwVl9IY+LZe4I0mK4MeYWAEfEdSS0KzQCmQQe2iCUW4JEq8loAGNsHAt9CoNA6iHrjSCRa4JEJOkP4HoAazXiaOibOwR0E/DYNC87ufA49wSJSKLiJ9cC2MeF00FH0xF4DMDxaV2TdeldIQjS5r3kYgBnuQQg6MocgVSyj6TlRaEIEq0mBwK4MuQBTuuRSE2vkrqdSvI3qY2QguLCESQiyWoArgBwQgqYBJXuEZgCYKTLjIfuTexYYyEJ0mbLdQgAlV7YMivAwjiJEHgZwChXiaQTjeyocaEJ0oYoYwGc6wiToMYNAk7qc7gxxV6LFwSJtl09o28mh9nDEXo6QGCG0jw1WtnJgR1OVHhDkDaryaEAVFlI99+DZIfAXABjGymYmZ2p8UfyjiBtiHJcVBYuVL2K/zzYtFSA4QTbOuQ2A2bZx1uCtCHKyQBOCzVLnD9WiwH8kuRE55pzpNB7grQhiqoOiSzhxKuxB1AnUxNJTm5MTTF6l4YgbYgyCIDIkklmvmI8BrGsVGbMySTviNXak0alI0gbovQGoKQR+oVAyI4faAUUKmHCr0g+7ckzn8iN0hKkLUrGmH4ABug2WyL0/G2skhV3kZzur4vxPAsEaYOTMWYNAPqO0lf3ouNB6E0r5QO4F8AMkp9541WDjgSCVAHQGLMKgIMBKDjymAZxzmv3qQAUPPggyS/zamQz7QoEiYm+MWYXAMorrO3YdjG75a3ZPADaNj1M8pm8GZdHewJBLGYl2ortHZ2EKbnENjlMV6T0OS8CUDIEnUA9QfJTC3dL3SUQxNH0G2OUjWWL6J6K0hZ1B7CRCkw6GqKaGhVKfR3AawD0VVv3Ll7JW3aQlDFITX0gSGrQfq04ep/pBmB9AOsBWBfANwB0jY6YlSxPv9WjXssAaAXQT0etHwFYAuB9AO8BeAfA2+G9If3JCwRJH+MwQoERCAQp8OQF09NHIBAkfYzDCAVG4P8BvMhYQbV7ingAAAAASUVORK5CYII=",(t=>{this.action.push(new O({image:t,corner:5,text:"替换",shape:this.shape})),this.shape.render()})),this.shape.canScale&&n("data:image/png;base64,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",(t=>{this.action.push(new B({image:t,corner:3,shape:this.shape})),this.shape.render()})),this.shape.canDo&&(this.action.push(new T({corner:1,shape:this.shape})),this.shape.render())}draw(){if(!this.shape)return!1;let{x:t,y:e,w:i,h:s}=this.shape.bound();const h=this.shape.getContext(),o=this.shape.stage().getConfig();h.beginPath(),h.save(!0),this.shape._rotate(),h.strokeStyle=o.activeColor,h.lineWidth=2,h.lineCap="round",h.lineJoin="round";const n=this.gap;h.strokeRect(t-n,e-n,i+2*n,s+2*n),h.closePath(),h.restore();for(const t of this.action)t&&t.draw()}click(t,e){this.active=null;for(const i of Object.values(this.action))if(!this.active&&i&&i.click(t,e))return this.active=i,!0;return!1}move(t,e){this.active.move(t,e)}tap(t){this.active.tap(t)}up(t){this.active.up(t)}}var k={_stage:null,_context:null,_preview:null,_startAgree:null,_startBound:null,_action:null,_acting:!1,_previous:null,_group:null,name:null,type:null,zIndex:0,fixed:null,actived:!1,clicked:!1,queue:!0,_colorBound:null,blendMode:"source-over",rotateRadius:0,rotateAroundCenter:!0,button_2_Text:"",reference:"view",stroke:!0,fill:!0,strokeStyle:"black",fillStyle:"transparent",fillRule:"nonzero",outline:!1,canMove:!0,canRotate:!0,canScale:!0,canUp:!0,canRemove:!0,canClick:!0,canActive:!0,canExport:!0,canSort:!0,canDo:!1,canFlip:!1,async init(){this._init&&await this._init(),this.canActive&&!this._action&&(this._action=new M({shape:this})),this.emit("init",{type:"init",stage:this._stage}),this.render()},set(t){this.each(t),this.render()},each(t){for(let e in t)this[e]=t[e]},click(t,e,i=!1,s=[]){if(this.canActive&&this.actived&&s.length<2){if(this._action.click(t,e))return this._acting=!0,!0;this._acting=!1}if(!this.canClick)return this.clicked=!1,!1;if(i)return this.clicked=!0,!0;const h=this._context;return h.save(),this._draw(),this.clicked=h.isPointInPath(t,e),h.restore(),this.clicked&&this.emit("click",{type:"click",x:t,y:e}),this.clicked}},P={_draw:null,_rotate:null,_init:null,draw:null,render(){this._stage&&this._stage.render()}},Q={_active(t,e=!0){t!==this.actived&&(this.canActive&&t?(this.emit("active",{type:"active",shape:this}),this.stage().emit("active",{type:"active",shape:this}),this.actived=t):(this.emit("deactivate",{type:"deactivate",shape:this}),e&&this.stage().emit("deactivate",{type:"deactivate",shape:this}),this.actived=!1),this.render())},active(){this._active(!0)},deactivate(t=!0){this._active(!1,t)},toggle(){return this._active(!this.actived),this.actived},props(t={}){const e=Object.assign({element:!0,private:!0,relative:!1,ignore:[]},t),i=Object.create(null);for(let t in this){if(e.ignore.indexOf("i")>-1)continue;if("function"==typeof this[t])continue;if(!e.private&&t.startsWith("_"))continue;const s=typeof this[t];(null===this[t]||"object"!==s||void 0===this[t].nodeType||e.element)&&(t.startsWith("_")||null!==this[t]&&"object"===s&&void 0!==this[t].nodeType?i[t]=this[t]:i[t]=a(this[t],e))}return i.zIndex=this.getIndex(),i.actived=!1,i.outline=!1,e.relative?Object.assign(i,this.relative()):i},toJson(t){const e=this.props(Object.assign({element:!1,private:!1},t));return this._stage&&(e.zIndex=this._stage.getIndex(this)),JSON.stringify(e)},bound(){},getRotateCoords(){const t=this.bound(),e=[];return e.push(y({x:t.x,y:t.y},x(this.rotateRadius),this.getCenterPoint())),e.push(y({x:t.x+t.w,y:t.y},x(this.rotateRadius),this.getCenterPoint())),e.push(y({x:t.x+t.w,y:t.y+t.h},x(this.rotateRadius),this.getCenterPoint())),e.push(y({x:t.x,y:t.y+t.h},x(this.rotateRadius),this.getCenterPoint())),e},getRotateBound(){return 0===this.rotateRadius?this.bound():this.getReference(this.getRotateCoords())},stage(){return this._stage},getContext(){return this._context},getIndex(){const t=this.stage();return t?this._group?this._group.getShapeIndex(this):t.getIndex(this):-1},moveIndex(t,e=!0,i=!1){if(!this.canSort&&!i)return-1;const s=this.getIndex();if(s<0)return-1;const h=this._group?this._group.getShapes():this.stage().shapes();if(t<0||t>=h.length)return-1;const o=this,n=0===t?0:t>s?1:-1;let r=t;if(!i)do{if(h[r].canSort)break;r+=n}while(r>0&&r<h.length);if(r<0||r>=h.length)return-1;if(r===s)return-1;if(!e)return r;if(this.emit("before-sort",{type:"before-sort",shape:o,index:r}),this.stage().emit("before-sort",{type:"before-sort",index:r,shape:o}),1===n)for(let t=s;t<r;t++)h[t]=h[t+1];else for(let t=s;t>r;t--)h[t]=h[t-1];return h[r]=o,this.emit("after-sort",{type:"after-sort",shape:o,index:r}),this.stage().emit("after-sort",{type:"after-sort",shape:o,index:r}),this.render(),r},moveTop(t=!0){return this.moveIndex(this.stage().shapes().length-1,t)},moveBottom(t=!0){return this.moveIndex(0,t)},forward(t=!0){return this.moveIndex(this.getIndex()+1,t)},backward(t=!0){return this.moveIndex(this.getIndex()-1,t)},destroy(t=!1){this._stage&&((this._group?this._group:this.stage()).remove(this,t),this.render())},bindContext(t){this._context=t},ColorBound(){const t=this.stage().bound(),e=this.stage().createCanvas(t._w,t._h).context,i=this.getContext();e.dpr(1),e.clearRect(0,0,t._w,t._h);const s=this.blendMode;this.bindContext(e),this.blendMode="source-over",this.draw(!1),this.bindContext(i),this.blendMode=s;const h=e.getImageData(0,0,Math.round(t._w),Math.round(t._h));let o=t._w,n=t._h,r=0,a=0;for(let e=0;e<t._h;e++)for(let i=0;i<t._w;i++){const s=Math.floor(4*(e*t._w+i));h.data[s+3]>0&&(o=Math.min(o,i),n=Math.min(n,e),r=Math.max(r,i),a=Math.max(a,e))}const l=u(this.stage().dpr(),3);return{_x:u(o,3),_y:u(n,3),_w:u(r-o,3),_h:u(a-n,3),x:u(o*l,3),y:u(n*l,3),w:u((r-o)*l,3),h:u((a-n)*l,3)}},getColorBound(t=!1){return t?this.ColorBound():(this._colorBound||(this._colorBound=this.ColorBound()),this._colorBound)},getReference(){const t=this.stage();if(this._group){const e=this._group.bound();return{x:e.x*t.dpr(),y:e.y*t.dpr(),w:e.w*t.dpr(),h:e.h*t.dpr(),_x:e.x,_y:e.y,_w:e.w,_h:e.h}}const e=t.getViewBound();return e&&"view"===this.reference?e:t.bound()},canShowOutline(){return this.stage().canShowOutline()},async copy(){const t=this.stage();if(!t)return!1;{t.emit("before-copy",{type:"before-copy",shape:this});const e=this.props({element:!0,private:!1,relative:!1});e.reference="stage",e.x+=10,e.y+=10,this.actived=!1;const i=t.load(e,!1);await t.add(i),i.reference="view",t.active(i),t.emit("after-copy",{type:"after-copy",shape:this})}},adjustX(t=1){this._group||this.emit("before-adjust",{type:"before-adjust",shape:this,direction:"x"}),this.x+=t,this._group||this.emit("after-adjust",{type:"after-adjust",shape:this,direction:"x"}),this.render()},adjustY(t=1){this._group||this.emit("before-adjust",{type:"before-adjust",shape:this,direction:"y"}),this.y+=t,this._group||this.emit("after-adjust",{type:"after-adjust",shape:this,direction:"y"}),this.render()},flipX(){this._group||this.emit("before-flip",{type:"before-flip",shape:this,direction:"x"}),this.flip.x=-1*this.flip.x,this._group||this.emit("after-flip",{type:"after-flip",shape:this,direction:"x"}),this.render()},flipY(){this._group||this.emit("before-flip",{type:"before-flip",shape:this,direction:"y"}),this.flip.y=-1*this.flip.y,this._group||this.emit("after-flip",{type:"after-flip",shape:this,direction:"y"}),this.render()},group(t){this._group=t},ungroup(t=!0){this._group.remove(this,!0,t),this._group=null,this.stage().pauseEvent("before-add"),this.stage().add(this),this.stage().resumeEvent("before-add")},setAttr(t,e){this[t]=e,this.render()},getCenterPoint(){let{x:t,y:e,w:i,h:s}=this.bound();return{x:t+i/2,y:e+s/2}},getReferCenterCoords(t){const e=this.getCenterPoint(!0);return{x:this.x+(t.x-e.x),y:this.y+(t.y-e.y)}}},L={save(){return this.props()},restore(t){this.each(t)}};let V=class{constructor(t){Object.assign(this,t),this._listener=new Map,this._previous={x:null,y:null,zoom:null,rotate:null}}};Object.assign(V.prototype,k,E,I,Q,P,L);let J=class extends V{constructor(t={}){super(Object.assign({x:null,y:null,w:null,h:null,url:null,originWidth:null,originHeight:null,image:null,type:"Image",button_2_Text:"替换",canDo:!0,canFlip:!0,flip:{x:1,y:1}},t)),this._initImage(t)}_initImage(t){if(t.image)return this.image=t.image,void(this.url=t.image.src);t.url&&(this.url=t.url,n(t.url,(t=>{this.image=t,this.originWidth=null,this.originHeight=null,this.emit("loaded",{type:"loaded",shape:this})}),(()=>{this.destroy()})))}_initCoords(){let{width:t,height:e}=this.image;this.originWidth=t,this.originHeight=e;const i=this.getReference(),s=this.stage().getConfig();let h=t<s.maxWidth?t:s.maxWidth,o=e<s.maxHeight?e:s.maxHeight;null===this.w&&null===this.h&&(i._w<=i._h?(this.w=h,this.h=this.w*(e/t)):(this.h=o,this.w=this.h*(t/e))),null===this.w&&this.h&&(this.w=this.h*(t/e)),this.w&&null===this.h&&(this.h=this.w*(e/t)),this.x=null!==this.x?this.x:(i._w-this.w)/2+i._x,this.y=null!==this.y?this.y:(i._h-this.h)/2+i._y,!this._colorBound&&this.outline&&this.initColorBound()}_updateCoords(){let{width:t,height:e}=this.image;this.originWidth=t,this.originHeight=e,this.w>this.h?this.h=this.w*(e/t):this.w=this.h*(t/e),this.outline&&this.initColorBound()}_init(){const t=this;if(t._context){const e=t.getReference();t.x&&"string"==typeof this.x&&(t.x=c(this.x,e._w)+e._x),t.y&&"string"==typeof this.y&&(t.y=c(this.y,e._h)+e._y),t.w&&"string"==typeof this.w&&(t.w=c(this.w,e._w)),t.h&&"string"==typeof this.h&&(t.h=c(this.h,e._h))}return new Promise((e=>{this._context&&t.image?(t.originWidth&&t.originHeight||t._initCoords(),t.render(),e()):t.on("loaded",(()=>{t._init(),t.removeAlllistener("loaded"),e()}),!0)}))}getFlip(){return this.canFlip?this.flip.x<0&&this.flip.y>0?1:this.flip.x>0&&this.flip.y<0?2:this.flip.x<0&&this.flip.y<0?3:0:0}_flip(){return this._context&&this.canFlip&&this._context.scale(this.flip.x,this.flip.y),this.getFlip()}_getFlip(){const t=this.getFlip(),{x:e,y:i,w:s,h:h}=this.bound();return 0===t?{_x:e,_y:i}:1===t?{_x:-e-s,_y:i}:2===t?{_x:e,_y:-i-h}:3===t?{_x:-e-s,_y:-i-h}:void 0}_draw(){if(!this.image)return;const t=this._context;let{x:e,y:i,w:s,h:h}=this.bound();t.beginPath(),this._rotate(),t.rect(e,i,s,h),t.closePath()}_rotate(t=null){let{x:e,y:i,w:s,h:h}=this;const o=t||this.getContext(),n=this._group?this._group.getCenterPoint():this.rotateAroundCenter?{x:e+s/2,y:i+h/2}:{x:this.x,y:this.y};0!==this.rotateRadius&&(o.translate(n.x,n.y),o.rotate(this.rotateRadius),o.translate(-n.x,-n.y))}update(t){this.canDo&&(this.on("loaded",(()=>{this._updateCoords(),this.removeAlllistener("loaded"),this.render()}),!0),this._initImage(t),this.render())}stokeOutline(){if(!this.outline)return;const t=this._context;t.beginPath(),t.save(),t.setViewClip&&t.setViewClip(),this._rotate(),this._flip(),this._stokeOutline(),t.closePath(),t.restore()}_stokeOutline(){const t=this._context;this._colorBound||this.initColorBound(),this.canShowOutline()&&(t.globalCompositeOperation="source-over",t.strokeStyle=this.stage().getConfig().themeColor,t.setLineDash([2,3]),t.lineWidth=1,t.lineCap="round",t.lineJoin="round",t.strokeRect(this._colorBound._x+1,this._colorBound._y+1,this._colorBound._w-2,this._colorBound._h-2))}draw(t=!0){if(!this.image)return;const e=this._context;let{w:i,h:s}=this;e.beginPath(),e.save(),e.setViewClip&&e.setViewClip(),this._rotate(),this._flip(),e.globalCompositeOperation=this.blendMode;const{_x:h,_y:o}=this._getFlip();if(e.drawImage(this.image,h,o,i,s),this.outline&&t&&this._stokeOutline(),e.closePath(),e.restore(),t&&this.actived){const t=this;this.queue?this.stage().addQueueTask((()=>{t._action.draw()})):t._action.draw()}}coords(t=null){const e=[{x:this.x,y:this.y},{x:this.x+this.w,y:this.y},{x:this.x,y:this.y+this.h},{x:this.x+this.w,y:this.y+this.h},{x:this.x+this.w/2,y:this.y},{x:this.x+this.w,y:this.y+this.h/2},{x:this.x,y:this.y+this.h/2},{x:this.x+this.w/2,y:this.y+this.h/2}];return null===t?e:e[t]}bound(){return{x:this.x,y:this.y,w:this.w,h:this.h}}relative(){const t=this.getReference();return{x:((this.x-t._x)/t._w*100).toFixed(2)+"%",y:((this.y-t._y)/t._h*100).toFixed(2)+"%",w:(this.w/t._w*100).toFixed(2)+"%",h:null}}initColorBound(){return this._colorBound=this.ColorBound(),this._colorBound}};class F extends V{constructor(t={}){super(Object.assign({x:null,y:null,button_2_Text:"编辑",canDo:!0,canFlip:!0,_bound:{x:null,y:null,w:null,h:null},flip:{x:1,y:1},maxWidth:50,maxHeight:50,text:"",fontSize:16,fontFamily:"Arial",textColor:"rgba(54,54,54,0.9)",bold:!1,italic:!1,textDecoration:!1,textBaseline:"middle",textAlign:"center",background:!0,cornerRadius:5,backgroundColor:"transparent",border:0,borderColor:"#000000",padding:{top:6,bottom:6,left:6,right:6},direction:"horizontal",maxLineWidth:null,letterSpacing:0,lineSpacing:0,spacingLeft:1,spacingTop:1,type:"Text"},t))}_init(){if(this._context){const t=this.getReference();this.x&&"string"==typeof this.x&&(this.x=c(this.x,t._w)+t._x),this.y&&"string"==typeof this.y&&(this.y=c(this.y,t._h)+t._y),this.fontSize&&"string"==typeof this.fontSize&&(this.fontSize=c(this.fontSize,t._h)),this.x=null!==this.x?this.x:t._w/2+t._x,this.y=null!==this.y?this.y:t._h/2+t._y,"Arial"!==this.fontFamily&&this.stage().emit("use-font",{type:"use-font",shape:this,fontFamily:this.fontFamily})}const t=this;this.input=e=>{t.text=e,t.render()},this.append=e=>{t.text+=e,t.render()}}setFont(t){this.fontFamily=t,this.render()}getFlip(){return this.canFlip?this.flip.x<0&&this.flip.y>0?1:this.flip.x>0&&this.flip.y<0?2:this.flip.x<0&&this.flip.y<0?3:0:0}_flip(){return this._context&&this.canFlip&&this._context.scale(this.flip.x,this.flip.y),this.getFlip()}_getFlip(){const t=this.getFlip(),{x:e,y:i,w:s,h:h}=this._bound;return 0===t?{_x:e,_y:i}:1===t?{_x:-e-s,_y:i}:2===t?{_x:e,_y:-i-h}:3===t?{_x:-e-s,_y:-i-h}:void 0}_getFlipText(){const t=this.getFlip(),{x:e,y:i}=this;return 0===t?{_x:e,_y:i}:1===t?{_x:-e,_y:i}:2===t?{_x:e,_y:-i}:3===t?{_x:-e,_y:-i}:void 0}_draw(){const t=this._context;let{x:e,y:i,w:s,h:h}=this._bound;t.beginPath(),this._rotate(),t.rect(e,i,s,h),t.closePath()}_rotate(){const t=this.getContext();let{x:e,y:i}=this._group?this._group.getCenterPoint():this.getCenterPoint();0!==this.rotateRadius&&(t.translate(e,i),t.rotate(this.rotateRadius),t.translate(-e,-i))}scale(t,e){if(!this._startBound){const t=this.stage().getLimit()&&e.length>1?p(e[0],e[1]):this._group?this._group.getCenterPoint():this.getCenterPoint();this._startBound={x:this.x,y:this.y,centerX:t.x,centerY:t.y,fontSize:this.fontSize}}const{x:i,y:s,centerX:h,centerY:o,fontSize:n}=this._startBound;return this.x=Math.floor(h-(h-i)*t),this.y=Math.floor(o-(o-s)*t),this.fontSize=n*t,this.emit("scale",{type:"scale",coords:e,zoom:t,shape:this}),this.stage().emit("scale",{type:"scale",coords:e,zoom:t,shape:this}),this.render(),!0}updateBound(){this._bound=this._context.textBound(this)}draw(t=!0){const e=this._context;e.beginPath(),e.save(),e.setViewClip&&e.setViewClip(),e.globalCompositeOperation=this.blendMode,this._bound=e.textBound(this),this._rotate(),this._flip();const{_x:i,_y:s}=this._getFlipText();if(e.drawText(Object.assign(this.getConfig(),{x:i,y:s})),this.textDecoration){let{w:t,h:i}=this.bound(),{_x:s,_y:h}=this._getFlip();e.beginPath(),e.strokeStyle=this.textColor,e.moveTo(s+this.padding.left,h+i-this.padding.bottom),e.lineTo(s+t-this.padding.right,h+i-this.padding.bottom),e.closePath(),e.stroke()}if(this._group&&this._group.actived){e.beginPath();const t=this.stage().getConfig();let{w:i,h:s}=this.bound(),{_x:h,_y:o}=this._getFlip();e.strokeStyle=t.activeColor,e.setLineDash([2,3]),e.lineWidth=1,e.lineCap="round",e.lineJoin="round";const n=2;e.strokeRect(h-n,o-n,i+2*n,s+2*n),e.closePath()}if(e.restore(),t&&this.actived){const t=this;this.queue?this.stage().addQueueTask((()=>{t._action.draw()})):t._action.draw()}}coords(t=null){const{x:e,y:i,w:s,h:h}=this._bound,o=[{x:e,y:i},{x:e+s,y:i},{x:e,y:i+h},{x:e+s,y:i+h},{x:e+s/2,y:i},{x:e+s,y:i+h/2},{x:e,y:i+h/2},{x:e+s/2,y:i+h/2}];return null===t?o:o[t]}bound(){return this._bound}getText(){return this.text}relative(){const t=this.getReference();return this.updateBound(),{x:((this.x-t._x)/t._w*100).toFixed(2)+"%",y:((this.y-t._y)/t._h*100).toFixed(2)+"%",maxWidth:(this.maxWidth/t._w*100).toFixed(2)+"%",maxHeight:(this.maxHeight/t._h*100).toFixed(2)+"%",fontSize:(this.fontSize/t._h*100).toFixed(2)+"%"}}getConfig(){const t={text:"",fontSize:16,bold:!1,italic:!1,textDecoration:!1,fontFamily:"Arial",textColor:"#ffffff",textAlign:"center",background:!0,cornerRadius:5,backgroundColor:"transparent",border:0,borderColor:"#000000",padding:{top:6,bottom:6,left:6,right:6},direction:"horizontal",maxLineWidth:null,letterSpacing:0,lineSpacing:0,x:0,y:0,_bound:null,spacingLeft:1,spacingTop:1};for(let e in t)this[e]&&(t[e]=this[e]);return t}}class Y extends V{constructor(t={}){super(Object.assign({x:null,y:null,w:null,h:null,shapes:[],type:"Group",canFlip:!0,ratio:1,button_2_Text:"解除",canDo:!0,fit:!1,rule:"bind",_activeChild:null,flip:{x:1,y:1},_inited:!1,_initedBound:!1},t))}each(t){for(let e in t)if("shapes"===e)for(let i=0;i<t[e].length;i++)this.shapes[i].each(t[e][i]);else this[e]=t[e]}async _init(){if(this._context){0===this.shapes.length&&this.destroy(!0),this.shapes=this.shapes.filter((t=>"Group"!==t.type));const t=this,e=t.getReference();t.x&&(t.x=c(this.x,e._w)+e._x),t.y&&(t.y=c(this.y,e._h)+e._y),t.w&&(t.w=c(this.w,e._w)),t.h&&(t.h=c(this.h,e._h)),this.w&&!this.h&&(this.h=this.w/this.ratio),!this.w&&this.h&&(this.w=this.h*this.ratio),this.w&&this.h&&this.fit&&(this.w>e._w&&(this.w=e._w,this.h=this.w/this.ratio),this.h>e._h&&(this.h=e._h,this.w=this.h*this.ratio),this.x=(e._w-this.w)/2+e._x,this.y=(e._h-this.h)/2+e._y);const i=[],s=[];let h=!1;for(let t of this.shapes)t.constructor&&"Object"!==t.constructor.name?(t.destroy(!0),t.each({_stage:this.stage(),_context:this.getContext(),actived:!1,clicked:!1}),t.group(this),h=!0):(t=this.stage().load(t,!1),t.each({_stage:this.stage(),_context:this.getContext(),_group:this,actived:!1,clicked:!1}),s.push(t.init())),i.push(t);if(s.length>0&&await Promise.all(s),this.shapes=i,h){this._adjust();const t=this.getCenterPoint();for(let e of this.getShapes(!0)){const i=m(e.getCenterPoint(),x(e.rotateRadius),t),s=e.getReferCenterCoords(i);e.adjustX(s.x-e.x),e.adjustY(s.y-e.y),"Text"===e.type&&e.updateBound()}}this._inited=!0,this.fit=!1,this.ratio=l(this.w/this.h,4),"unbind"===this.rule&&this.unbind(),this.emit("loaded",{shape:this,type:"loaded"}),this.render()}}clickText(t,e,i=!1,s=[]){for(const h of this.shapes)if("Text"===h.type&&h&&h.click(t,e,i,s))return this.stage().emit("click-group-text",{type:"click-group-text",group:this,shape:h}),this._activeChild=h,!0;this._activeChild=null}_draw(){if(!this._inited)return;const t=this._context;let{x:e,y:i,w:s,h:h}=this.bound();t.beginPath(),this._rotate(),t.rect(e,i,s,h),t.closePath()}getCenterPoint(){let{x:t,y:e,w:i,h:s}=(this._group?this._group:this).bound();return{x:t+i/2,y:e+s/2}}_rotate(t=null){const e=t||this.getContext(),i=this.rotateAroundCenter?this.getCenterPoint():{x:this.x,y:this.y};0!==this.rotateRadius&&(e.translate(i.x,i.y),e.rotate(this.rotateRadius),e.translate(-i.x,-i.y))}draw(t=!0){if(!this.shapes.length||!this._inited)return!1;for(const t of this.shapes)t&&(t.bindContext(this._context),t.draw());if(t&&this.actived){const t=this;this.queue?this.stage().addQueueTask((()=>{t._action.draw()})):t._action.draw()}}move(t,e){if(!this._inited)return;if(t.length>1)return!1;const{x:i,y:s}=t[0];if(i===this._previous.x&&s===this._previous.y)return!1;if(this._previous.x=i,this._previous.y=s,this.actived&&this._action&&this._acting)return this._action.move(t,e),this.render(),!0;this.emit("move",{type:"move",coords:t,offset:e,shape:this}),this.stage().emit("move",{type:"move",coords:t,offset:e,shape:this});let h=i-e.x,o=s-e.y,n=h-this.x,r=o-this.y;for(const t of this.shapes)t&&(t.adjustX(n),t.adjustY(r));return this.x=h,this.y=o,this.render(),!0}scale(t,e){if(!this._inited)return;for(const i of this.shapes)i&&i.scale(t,e);if(!this._startBound){const t=this.stage().getLimit()&&e.length>1?p(e[0],e[1]):this._group?this._group.getCenterPoint():{x:this.x+this.w/2,y:this.y+this.h/2};this._startBound={w:this.w,h:this.h,x:this.x,y:this.y,centerX:t.x,centerY:t.y}}t=l(t,2);const{x:i,y:s,w:h,h:o,centerX:n,centerY:r}=this._startBound;return this.x=n-(n-i)*t,this.y=r-(r-s)*t,this.w=h*t,this.h=o*t,this.emit("scale",{type:"scale",coords:e,zoom:t,shape:this}),this.stage().emit("scale",{type:"scale",coords:e,zoom:t,shape:this}),this.render(),!0}rotate(t,e){if(this._inited){for(const i of this.shapes)i&&i.rotate(t,e);if(1===e.length)this._startAgree||(this._startAgree=this.rotateRadius),this.rotateRadius=this._startAgree+t;else{const e=this.stage().getConfig();Math.abs(t-this.rotateRadius)>e.minRotatable&&(this.rotateRadius+=t/(100-e.sensitivity))}return this.emit("rotate",{type:"rotate",coords:e,rad:t,shape:this}),this.stage().emit("rotate",{type:"rotate",coords:e,rad:t,shape:this}),this.render(),!0}}tap(t){if(this._inited)return this.emit("tap",{type:"tap",coords:t,shape:this}),this.stage().emit("tap",{type:"tap",coords:t,shape:this}),this.actived&&this._action&&this._acting?(this._action.tap(t),this.render(),this.actived):(this.actived&&this.clickText(t.x,t.y,!1,[t])||(this.toggle(),this.render()),this.actived)}up(t){if(this._inited){for(const e of this.shapes)e&&e.up(t);this._startAgree=null,this._startBound=null,this.actived&&this._action&&this._acting&&(this._action.up(t),this.render()),this._group||(this.emit("up",{type:"up",coords:t,shape:this}),this.stage().emit("up",{type:"up",coords:t,shape:this}))}}flipX(){this._group||this.emit("before-flip",{type:"before-flip",shape:this,direction:"x"}),this.flip.x=-1*this.flip.x;for(const t of this.shapes)t&&t.flipX();this._group||this.emit("after-flip",{type:"after-flip",shape:this,direction:"x"}),this.render()}flipY(){this._group||this.emit("before-flip",{type:"before-flip",shape:this,direction:"y"}),this.flip.y=-1*this.flip.y;for(const t of this.shapes)t&&t.flipY();this._group||this.emit("after-flip",{type:"after-flip",shape:this,direction:"y"}),this.render()}coords(t=null){const e=[{x:this.x,y:this.y},{x:this.x+this.w,y:this.y},{x:this.x,y:this.y+this.h},{x:this.x+this.w,y:this.y+this.h},{x:this.x+this.w/2,y:this.y},{x:this.x+this.w,y:this.y+this.h/2},{x:this.x,y:this.y+this.h/2},{x:this.x+this.w/2,y:this.y+this.h/2}];return null===t?e:e[t]}bound(){return{x:this.x,y:this.y,w:this.w,h:this.h}}relative(){const t=this.getReference();return{x:((this.x-t._x)/t._w*100).toFixed(2)+"%",y:((this.y-t._y)/t._h*100).toFixed(2)+"%",w:null,h:(this.h/t._h*100).toFixed(2)+"%"}}adjustX(t=1){this._group||this.emit("before-adjust",{type:"before-adjust",shape:this,direction:"x"});for(const e of this.shapes)e&&(e.x+=t);this.x+=t,this._group||this.emit("after-adjust",{type:"after-adjust",shape:this,direction:"x"}),this.render()}adjustY(t=1){this._group||this.emit("before-adjust",{type:"before-adjust",shape:this,direction:"y"});for(const e of this.shapes)e&&(e.y+=t);this.y+=t,this._group||this.emit("after-adjust",{type:"after-adjust",shape:this,direction:"y"}),this.render()}async copy(){const t=this.stage();if(!t)return!1;{t.emit("before-copy",{type:"before-copy",shape:this});const e=this.props({element:!0,private:!1,relative:!1,ignore:["shapes"]});e.shapes=this.shapes.map((t=>{const e=t.props({element:!0,private:!1,relative:!1});return e.x+=10,e.y+=10,e})),e.reference="stage",e.x+=10,e.y+=10,this.actived=!1,e.fit=!1;const i=t.load(e,!1);await t.add(i),i.reference="view",t.active(i),t.emit("after-copy",{type:"after-copy",shape:this})}}_adjust(){Object.assign(this,w(this.shapes.map((t=>t.bound()))))}unbind(){this.stage().emit("before-unbind",{type:"before-unbind",shape:this});const t=this.getCenterPoint();for(let e of this.getShapes(!0)){"Text"===e.type&&e.updateBound(),e.ungroup(!1);const i=y(e.getCenterPoint(),x(e.rotateRadius),t),s=e.getReferCenterCoords(i);e.adjustX(s.x-e.x),e.adjustY(s.y-e.y)}this.destroy(!0),this.stage().emit("after-unbind",{type:"after-unbind",shape:this})}getShapes(t=!1,e=-1){if(-1===e)return t?this.shapes.map((t=>t)):this.shapes;if("number"==typeof e)return this.shapes[e]?this.shapes[e]:null;if("string"==typeof e)for(let t of this.shapes)if(t.name===e)return t}getShapeIndex(t){return this.shapes.indexOf(t)}remove(t,e=!1,i=!1){if(e){const e=this.shapes.indexOf(t);return e>-1&&this.shapes.splice(e,1),i&&this._adjust(),!0}return!!t&&(!!t.canRemove&&(this.stage().emit("before-delete",{type:"before-delete",shape:t}),this.shapes=this.shapes.filter((function(e){return!e.canRemove||("string"==typeof t?e.name!==t:e!==t)})),this.stage().emit("after-delete",{type:"after-delete",shape:t}),i&&this._adjust(),void this.render()))}save(){return{props:this.props(),shapes:this.getShapes(!0)}}restore(t){this.shapes=t.shapes,this.each(t.props)}getActive(){return this._activeChild}group(t){this._group=t}ungroup(t=!0){this._group.remove(this,!0,t),this._group=null,this.stage().pauseEvent("before-add"),this.stage().add(this),this.stage().pauseEvent("before-add")}}var j={Image:J,Text:F,Group:Y},D={async add(t,e=-1){this.emit("before-add",{type:"before-add",shape:t}),this._shapes.push(t);const i=[];for(let t of this._shapes)t.fixed&&i.push(t);t.each({_stage:this,_context:this.getContext()});const s=this._shapes.length;for(let t of i)t.moveIndex(t.fixed<0?s+t.fixed:t.fixed-1,!0,!0);return e>=0&&t.moveIndex(e),await t.init(),t.actived&&this.active(t),this.emit("after-add",{type:"after-add",shape:t}),this.render(),t},active(t){if(!this._multiActive)for(let t of this.shapes())t.deactivate(!1);t.active(),this._actived=t},get(t){for(let e of this._shapes)if(e.name===t)return e},remove(t,e=!1){if(e){this.emit("before-delete",{type:"before-delete",shape:t});const e=this._shapes.indexOf(t);e>-1&&this._shapes.splice(e,1)}else{if(!t)return!1;if(!t.canRemove)return!1;this.emit("before-delete",{type:"before-delete",shape:t}),this._shapes=this._shapes.filter((function(e){return!e.canRemove||("string"==typeof t?e.name!==t:e!==t)}))}t.actived&&(this.emit("deactivate",{type:"deactivate",shape:t}),this._actived=null),this.emit("after-delete",{type:"after-delete",shape:t}),this.render()},load(t,e=!0){if("string"==typeof t&&(t=JSON.parse(t)),!t.type)return!1;if(!j[t.type])return!1;const i=new j[t.type](t);return e&&(this.add(i,t.zIndex),this.render()),i},clear(){this._shapes=this._shapes.filter((function(t){return!t.canRemove})),this._actived&&(this.emit("deactivate",{type:"deactivate",shape:this._actived}),this._actived=null),this.emit("clear",{type:"clear",shape:this._actived}),this.render()},hiddenOutline(){this.config.showOutline=!1},showOutline(){this.config.showOutline=!0},canShowOutline(){return this.config.showOutline}},z={enableMultiActive(){this._multiActive=!0},disableMultiActive(){this._actived=null,this._multiActive=!1;for(let t of this.shapes())t.deactivate();this._render(!1)},getConfig(){const t=this.config,e=this.getViewBound(),i=e||this.bound();return{maxWidth:i._w*t.maxWidth,maxHeight:i._h*t.maxHeight,sensitivity:t.sensitivity,minRotatable:t.minRotatable,themeColor:t.themeColor,activeColor:t.activeColor}},setConfig(t,e){this.config[t]=e},getContext(){return this._useBuffer?this._custom.bufferContext:this._custom.context},getElement(){return this._elem},setElementStyle(t){const e=this.getElement();for(let i in t)e.style[i]=t[i];this._initBound()},setOffset(t){if(null===t.x||null===t.y)return;t.y=c(t.y,this.bound()._h),t.x=c(t.x,this.bound()._w);this.getElement().setAttribute("style",`transform:translateX(${t.x}px) translateY(${t.y}px);`),this._scale=1,t.y+=this.$offset.y,t.x+=this.$offset.x,this._offset=t},resetOffset(){this.setOffset({x:0,y:0})},scale(t){this.getElement().setAttribute("style",`transform:scale(${t})`),this._scale=t},getScale(){return this._scale},getQueue(){return this._queue},clearQueue(){this._queue=[]},addQueueTask(t){this._queue.push(t)},getModel(){return this._model},renderModel(){const t=this.getModel(),e=t.context,i=t.shapes;e.beginPath(),e.clearRect(0,0,this._bound.w,this._bound.h);for(const t of i)t.draw()},addModel(t){const e=this,i=this.getModel();i.shapes.push(t),t.set({_stage:this,_context:i.context,render:()=>{e.renderModel()}}),t.init(),this.renderModel()},getModelShapes(t=!1,e=-1){const i=this.getModel();if(-1===e)return t?i.shapes.map((t=>t)):this._shapes;if("number"==typeof e)return i.shapes[e]?i.shapes[e]:null;if("string"==typeof e)for(let t of i.shapes)if(t.name===e)return t},setModel(t){this.getModel().shapes=[],this.addModel(t)},clearModel(){this.getModel().shapes=[],this.renderModel()},reset(){this.clear(),this.clearView(),this.clearModel(),this.emit("reset")},clearView(){this._view.shape=null},async setView(t){t.set({_stage:this,_context:this._custom.context}),await t.init(),this._view.shape=t,this._view.bound=t.getColorBound(),this.getContext().setViewClip=()=>{const{_x:t,_y:e,_w:i,_h:s}=this._view.bound;this.getContext().rect(t,e,i,s),this.getContext().clip()}},toJson(){const t={model:[],custom:[],view:null},e=this.getModel();if(e.shapes&&e.shapes.length>0)for(let i of e.shapes)t.model.push(i.props({element:!1,private:!1,relative:!0}));for(let e of this._shapes)t.custom.push(e.props({element:!1,private:!1,relative:!0}));return this._view.shape&&(t.view=this._view.shape.props({element:!1,private:!1,relative:!0})),JSON.stringify(t)},async loadJson(t,e={}){this.emit("load-json");const i=Object.assign({view:!0,model:!0,custom:!0},e);if("string"==typeof t)try{t=JSON.parse(t)}catch(t){return}if(i.model&&t.model&&Array.isArray(t.model)){this.getModel().shapes=[];for(let e of t.model)this.addModel(this.load(e,!1));this.renderModel()}if(i.view&&t.view){this.clearView();const e=this.load(t.view,!1);await this.setView(e)}if(i.custom&&t.custom&&Array.isArray(t.custom)){this._shapes=[];for(let e of t.custom)this.load(e);this.render()}this.clearSnap(),this.emit("loaded-json")},async loadJsonWithSnap(t,e={}){if(!t)return;this.emit("load-json-with-snap");const i=Object.assign({view:!0,model:!0,custom:!0},e);if("string"==typeof t)try{t=JSON.parse(t)}catch(t){return}const s={model:[],custom:[],view:null};if(i.model&&t.model&&Array.isArray(t.model)){const e=this.getModel();for(let i of t.model){const t=this.load(i,!1);t.each({_stage:this,_context:e.context}),await t.init(),s.model.push(t)}}let h=null;if(i.view&&t.view){const e=this.load(t.view,!1);e.set({_stage:this,_context:this._custom.context}),await e.init(),s.view=e,h=e.getColorBound()}if(i.custom&&t.custom&&Array.isArray(t.custom))for(let e of t.custom){const t=this.load(e,!1);s.custom.push(t),t.each({_stage:this,_context:this.getContext()});const i={getReference:t.getReference};t.getReference=function(){return h&&"view"===this.reference?h:this.bound()},"Group"===t.type&&(i.unbind=t.unbind,t.unbind=function(){const t=this.getCenterPoint();for(let e of this.getShapes(!0)){"Text"===e.type&&e.updateBound();const i=y(e.getCenterPoint(),x(e.rotateRadius),t),h=e.getReferCenterCoords(i);e.adjustX(h.x-e.x),e.adjustY(h.y-e.y),e._group.remove(this,!0,!1),e._group=null,s.custom.push(e)}const e=s.custom.indexOf(this);e>-1&&s.custom.splice(e,1)}),await t.init();for(let e in i)t[e]=i[e]}return this.emit("loaded-jso-with-snap"),s},getCenterPoint(){const t=this.bound();return{x:this._offset.x+t._w/2,y:this._offset.y+t._h/2}},filterCoords(t){const e=this.getScale(),i=this.getCenterPoint();for(let s of t)s.x-=this._offset.x,s.y-=this._offset.y,s.x=i.x-(i.x-s.x)/e,s.y=i.y-(i.y-s.y)/e;return t},stop(){this._stop=!0},resume(){this._stop=!1}};class U{constructor(t){this.maxLength=t,this.queue=[]}get length(){return this.queue.length}push(t){this.queue.length>=this.maxLength&&this.queue.shift(),this.queue.push(t)}pop(){return this.queue.pop()}clear(){this.queue=[]}}var H={z:new U(30),y:new U(30),n:30,r(t=null){this._stack&&(this.z.push(t||this.snap()),this.y.clear(),this.snapTest())},async alter(t,e=!1){if(e)await this.setView(t.view),this.getModel().shapes=t.model,this._shapes=t.custom,this.render(),this.renderModel();else{const e=[];for(let i of t){const t=i.shape;t.restore(i.snap),e.push(t)}this._shapes=e,this.snapTest(),this.render()}},undo(){if(0===this.z.length)return;this.y.push(this.snap());const t=this.z.pop();this.alter(t),this.emit("undo",{type:"undo"}),this.emit("deactivate",{type:"deactivate"})},redo(){if(0===this.y.length)return;this.z.push(this.snap());const t=this.y.pop();this.alter(t),this.emit("redo",{type:"redo"}),this.emit("deactivate",{type:"deactivate"})},snap(t=!1){if(t){const t={model:[],custom:[],view:null};return t.view=this._view.shape,t.model=this.getModel().shapes,t.custom=this.shapes(),t}{const t=[];for(let e of this.shapes())t.push({shape:e,snap:e.save()});return t}},clearSnap(){this.z.clear(),this.y.clear(),this.snapTest()},snapTest(){this.emit("snap-change",{type:"snap-change",z:this.z.length,y:this.y.length})}};class N{constructor(t){Object.assign(this,{_elem:t,_custom:{},_model:{},_shapes:[],_global:window,_event:Object.create(null),_gesture:null,_queue:[],_view:{bound:null,shape:null},_offset:{x:0,y:0},$offset:{x:0,y:0},_scale:1,_bound:{x:0,y:0,w:null,h:null,_w:null,_h:null},_loop:!0,_mode:"auto",_limit:!1,_stop:!1,_clicked:null,_actived:null,_isMoving:!1,_dpr:window.devicePixelRatio,_startOffset:null,_startPoint:null,_new:!0,_multiActive:!1,_useBuffer:!1,_stack:!0,config:{maxWidth:.8,maxHeight:.8,sensitivity:50,minRotatable:.15,themeColor:"#528ffa",activeColor:"#FFFFFF95",showOutline:!0}}),this._init()}}Object.assign(N.prototype,b,C,_,D,z,H);var W={Stage:N,Image:J,Text:F,Group:Y};exports.chooseFile=function(){return new Promise((t=>{window.chooseFileInput||(window.chooseFileInput=document.createElement("input"),window.chooseFileInput.type="file"),window.chooseFileInput.value="";const e=window.chooseFileInput;e.accept="image/*",e.onchange=()=>{const i=e.files[0];t(i||!1)},e.click()}))},exports.cloneDeep=a,exports.debounce=r,exports.default=W,exports.delay=function(t,e){let i=setTimeout((()=>{clearTimeout(i),t()}),e)},exports.downloadBlob=function(t,e){const i=URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=e,s.click(),URL.revokeObjectURL(i)},exports.getAngle=f,exports.getBoundingBox=w,exports.getCoordsBox=function(t){let e=Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE,h=Number.MIN_VALUE;return t.forEach((function(t){e=Math.min(e,t.x),i=Math.min(i,t.y),s=Math.max(s,t.x),h=Math.max(h,t.y)})),{x:e,y:i,w:s-e,h:h-i}},exports.getCoordsByBound=function(t){return[{x:t.x,y:t.y},{x:t.x+t.w,y:t.y},{x:t.x,y:t.y+t.h},{x:t.x+t.w,y:t.y+t.h}]},exports.getEnd=o,exports.getLength=g,exports.getPosOfEvent=h,exports.getVector=d,exports.isOutBound=function(t,e){const i=t.x,s=t.x+t.w,h=t.y,o=t.y+t.h;for(let t=0;t<e.length;t++){const n=e[t];if(n.x<i||n.x>s||n.y<h||n.y>o)return!0}},exports.loadImage=n,exports.moveElem=function(t,e,i){if(0===t.length)return!1;if(!t.includes(e))return!1;const s=t.indexOf(e),h=t.length-1;return s!==(i=Math.max(0,Math.min(i,h)))&&(t.splice(s,1),t.splice(i,0,e),t)},exports.radToDegree=x,exports.renameProperty=function(t,e,i){if(t.hasOwnProperty(e)){const s=t[e];delete t[e],t[i]=s}},exports.reverseRotatePoint=m,exports.rotateVector=y,exports.scaleVector=v,exports.throttle=function(t,e=3e3){let i=0;return(...s)=>{const h=+new Date;h-i>e&&(i=h,t.apply(this,s))}};
